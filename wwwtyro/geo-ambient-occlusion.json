{"readme":"<h1 class=\"title\"><a target=\"_blank\" href=\"https://github.com/wwwtyro/geo-ambient-occlusion\">geo-ambient-occlusion</a><div class=\"contrib\"></div></h1>\n<p>Generates a per-vertex ambient occlusion array for arbitrary meshes.</p>\n<p><iframe scrolling=\"no\" seamless=\"seamless\" src=\"http://wwwtyro.github.io/geo-ambient-occlusion/\"></iframe></p>\n<p><a href=\"http://wwwtyro.github.io/geo-ambient-occlusion/\">Demo</a></p>\n<blockquote>\n<p>Note: requires support for renderable <code>FLOAT</code> textures.</p>\n</blockquote>\n<h2 id=\"how-does-it-work-\">How does it work?</h2>\n<p><code>geo-ambient-occlusion</code> renders multiple shadow maps for your mesh from random viewpoints. It averages the occlusion\nfor each vertex across all the shadow maps to calculate an ambient occlusion value for each. This data is converted\ninto a <code>Float32Array</code> of shading (1.0 - occlusion) values and returned to you for immediate use as an attribute in your\nWebGL shader program.</p>\n<h2 id=\"install\">Install</h2>\n<pre><code class=\"lang-sh\"><div class=\"line\"><span class=\"source shell\"><span>npm&#xA0;install&#xA0;geo-ambient-occlusion</span></span></div>\n</code></pre>\n<h2 id=\"example\">Example</h2>\n<h3 id=\"javascript\">Javascript</h3>\n<pre><code class=\"lang-js\"><div class=\"line\"><span class=\"source js\"><span class=\"storage type var js\"><span>var</span></span><span>&#xA0;mesh&#xA0;</span><span class=\"keyword operator assignment js\"><span>=</span></span><span>&#xA0;</span><span class=\"support function js\"><span>require</span></span><span class=\"meta brace round js\"><span>(</span></span><span class=\"string quoted single js\"><span class=\"punctuation definition string begin js\"><span>&apos;</span></span><span>stanford-dragon/3</span><span class=\"punctuation definition string end js\"><span>&apos;</span></span></span><span class=\"meta brace round js\"><span>)</span></span></span></div><div class=\"line\"><span class=\"source js\"><span class=\"storage type var js\"><span>var</span></span><span>&#xA0;GeoAO&#xA0;</span><span class=\"keyword operator assignment js\"><span>=</span></span><span>&#xA0;</span><span class=\"support function js\"><span>require</span></span><span class=\"meta brace round js\"><span>(</span></span><span class=\"string quoted single js\"><span class=\"punctuation definition string begin js\"><span>&apos;</span></span><span>geo-ambient-occlusion</span><span class=\"punctuation definition string end js\"><span>&apos;</span></span></span><span class=\"meta brace round js\"><span>)</span></span></span></div><div class=\"line\"><span class=\"source js\"><span>&#xA0;</span></span></div><div class=\"line\"><span class=\"source js\"><span class=\"storage type var js\"><span>var</span></span><span>&#xA0;geometry&#xA0;</span><span class=\"keyword operator assignment js\"><span>=</span></span><span>&#xA0;</span><span class=\"meta function-call js\"><span class=\"entity name function js\"><span>Geometry</span></span><span class=\"punctuation definition arguments begin js\"><span>(</span></span><span>gl</span><span class=\"punctuation definition arguments end js\"><span>)</span></span></span></span></div><div class=\"line\"><span class=\"source js\"><span class=\"variable other object js\"><span>geometry</span></span><span class=\"meta method-call js\"><span class=\"meta delimiter method period js\"><span>.</span></span><span class=\"entity name function js\"><span>attr</span></span><span class=\"punctuation definition arguments begin js\"><span>(</span></span><span class=\"string quoted single js\"><span class=\"punctuation definition string begin js\"><span>&apos;</span></span><span>aPosition</span><span class=\"punctuation definition string end js\"><span>&apos;</span></span></span><span class=\"meta delimiter object comma js\"><span>,</span></span><span>&#xA0;</span><span class=\"variable other object js\"><span>mesh</span></span><span class=\"meta delimiter property period js\"><span>.</span></span><span class=\"variable other property js\"><span>positions</span></span><span class=\"punctuation definition arguments end js\"><span>)</span></span></span></span></div><div class=\"line\"><span class=\"source js\"><span class=\"variable other object js\"><span>geometry</span></span><span class=\"meta method-call js\"><span class=\"meta delimiter method period js\"><span>.</span></span><span class=\"entity name function js\"><span>faces</span></span><span class=\"punctuation definition arguments begin js\"><span>(</span></span><span class=\"variable other object js\"><span>mesh</span></span><span class=\"meta delimiter property period js\"><span>.</span></span><span class=\"support constant dom js\"><span>cells</span></span><span class=\"punctuation definition arguments end js\"><span>)</span></span></span></span></div><div class=\"line\"><span class=\"source js\"><span>&#xA0;</span></span></div><div class=\"line\"><span class=\"source js\"><span class=\"storage type var js\"><span>var</span></span><span>&#xA0;aoSampler&#xA0;</span><span class=\"keyword operator assignment js\"><span>=</span></span><span>&#xA0;</span><span class=\"meta class instance constructor\"><span class=\"keyword operator new js\"><span>new</span></span><span>&#xA0;</span><span class=\"entity name type instance js\"><span>GeoAO</span></span></span><span class=\"meta brace round js\"><span>(</span></span><span class=\"variable other object js\"><span>mesh</span></span><span class=\"meta delimiter property period js\"><span>.</span></span><span class=\"variable other property js\"><span>positions</span></span><span class=\"meta delimiter object comma js\"><span>,</span></span><span>&#xA0;</span><span class=\"meta brace curly js\"><span>{</span></span></span></div><div class=\"line\"><span class=\"source js\"><span>&#xA0;&#xA0;resolution</span><span class=\"keyword operator js\"><span>:</span></span><span>&#xA0;</span><span class=\"constant numeric js\"><span>256</span></span><span class=\"meta delimiter object comma js\"><span>,</span></span></span></div><div class=\"line\"><span class=\"source js\"><span>&#xA0;&#xA0;bias</span><span class=\"keyword operator js\"><span>:</span></span><span>&#xA0;</span><span class=\"constant numeric js\"><span>0.01</span></span><span class=\"meta delimiter object comma js\"><span>,</span></span></span></div><div class=\"line\"><span class=\"source js\"><span>&#xA0;&#xA0;cells</span><span class=\"keyword operator js\"><span>:</span></span><span>&#xA0;</span><span class=\"variable other object js\"><span>mesh</span></span><span class=\"meta delimiter property period js\"><span>.</span></span><span class=\"support constant dom js\"><span>cells</span></span></span></div><div class=\"line\"><span class=\"source js\"><span class=\"meta brace curly js\"><span>}</span></span><span class=\"meta brace round js\"><span>)</span></span></span></div><div class=\"line\"><span class=\"source js\"><span>&#xA0;</span></span></div><div class=\"line\"><span class=\"source js\"><span>ao&#xA0;</span><span class=\"keyword operator assignment js\"><span>=</span></span><span>&#xA0;</span><span class=\"variable other object js\"><span>aoSampler</span></span><span class=\"meta method-call js\"><span class=\"meta delimiter method period js\"><span>.</span></span><span class=\"entity name function js\"><span>sample</span></span><span class=\"punctuation definition arguments begin js\"><span>(</span></span><span class=\"constant numeric js\"><span>256</span></span><span class=\"punctuation definition arguments end js\"><span>)</span></span></span></span></div><div class=\"line\"><span class=\"source js\"><span class=\"variable other object js\"><span>geometry</span></span><span class=\"meta method-call js\"><span class=\"meta delimiter method period js\"><span>.</span></span><span class=\"entity name function js\"><span>attr</span></span><span class=\"punctuation definition arguments begin js\"><span>(</span></span><span class=\"string quoted single js\"><span class=\"punctuation definition string begin js\"><span>&apos;</span></span><span>aOcclusion</span><span class=\"punctuation definition string end js\"><span>&apos;</span></span></span><span class=\"meta delimiter object comma js\"><span>,</span></span><span>&#xA0;ao</span><span class=\"meta delimiter object comma js\"><span>,</span></span><span>&#xA0;</span><span class=\"meta brace curly js\"><span>{</span></span><span>size</span><span class=\"keyword operator js\"><span>:</span></span><span>&#xA0;</span><span class=\"constant numeric js\"><span>1</span></span><span class=\"meta brace curly js\"><span>}</span></span><span class=\"punctuation definition arguments end js\"><span>)</span></span></span></span></div><div class=\"line\"><span class=\"source js\"><span>&#xA0;</span></span></div><div class=\"line\"><span class=\"source js\"><span class=\"variable other object js\"><span>geometry</span></span><span class=\"meta method-call js\"><span class=\"meta delimiter method period js\"><span>.</span></span><span class=\"entity name function js\"><span>bind</span></span><span class=\"punctuation definition arguments begin js\"><span>(</span></span><span>program</span><span class=\"punctuation definition arguments end js\"><span>)</span></span></span></span></div><div class=\"line\"><span class=\"source js\"><span class=\"variable other object js\"><span>geometry</span></span><span class=\"meta method-call js\"><span class=\"meta delimiter method period js\"><span>.</span></span><span class=\"entity name function js\"><span>draw</span></span><span class=\"punctuation definition arguments begin js\"><span>(</span></span><span class=\"variable other object js\"><span>gl</span></span><span class=\"meta delimiter property period js\"><span>.</span></span><span class=\"constant other property js\"><span>TRIANGLES</span></span><span class=\"punctuation definition arguments end js\"><span>)</span></span></span></span></div>\n</code></pre>\n<h3 id=\"vertex-shader\">Vertex Shader</h3>\n<pre><code class=\"lang-glsl\"><div class=\"line\"><span class=\"source glsl\"><span class=\"storage modifier glsl\"><span>attribute</span></span><span>&#xA0;</span><span class=\"storage type glsl\"><span>vec3</span></span><span>&#xA0;aPosition;</span></span></div><div class=\"line\"><span class=\"source glsl\"><span class=\"storage modifier glsl\"><span>attribute</span></span><span>&#xA0;</span><span class=\"storage type glsl\"><span>float</span></span><span>&#xA0;aOcclusion;</span></span></div><div class=\"line\"><span class=\"source glsl\"><span>&#xA0;</span></span></div><div class=\"line\"><span class=\"source glsl\"><span class=\"storage modifier glsl\"><span>uniform</span></span><span>&#xA0;</span><span class=\"storage type glsl\"><span>mat4</span></span><span>&#xA0;uModel;</span></span></div><div class=\"line\"><span class=\"source glsl\"><span class=\"storage modifier glsl\"><span>uniform</span></span><span>&#xA0;</span><span class=\"storage type glsl\"><span>mat4</span></span><span>&#xA0;uView;</span></span></div><div class=\"line\"><span class=\"source glsl\"><span class=\"storage modifier glsl\"><span>uniform</span></span><span>&#xA0;</span><span class=\"storage type glsl\"><span>mat4</span></span><span>&#xA0;uProjection;</span></span></div><div class=\"line\"><span class=\"source glsl\"><span>&#xA0;</span></span></div><div class=\"line\"><span class=\"source glsl\"><span class=\"storage modifier glsl\"><span>varying</span></span><span>&#xA0;</span><span class=\"storage type glsl\"><span>float</span></span><span>&#xA0;vOcclusion;</span></span></div><div class=\"line\"><span class=\"source glsl\"><span>&#xA0;</span></span></div><div class=\"line\"><span class=\"source glsl\"><span class=\"storage type glsl\"><span>void</span></span><span class=\"meta function c\"><span class=\"punctuation whitespace function leading c\"><span>&#xA0;</span></span><span class=\"entity name function c\"><span>main</span></span><span class=\"meta parens c\"><span class=\"punctuation section parens begin c\"><span>(</span></span><span class=\"punctuation section parens end c\"><span>)</span></span></span><span>&#xA0;</span><span class=\"meta block c\"><span class=\"punctuation section block begin c\"><span>{</span></span></span></span></span></div><div class=\"line\"><span class=\"source glsl\"><span class=\"meta function c\"><span class=\"meta block c\"><span>&#xA0;&#xA0;&#xA0;&#xA0;</span><span class=\"support variable glsl\"><span>gl_Position</span></span><span>&#xA0;=&#xA0;uProjection&#xA0;*&#xA0;uView&#xA0;*&#xA0;uModel&#xA0;*</span><span class=\"meta function-call c\"><span class=\"punctuation whitespace function-call leading c\"><span>&#xA0;</span></span><span class=\"support function any-method c\"><span>vec4</span></span><span>(</span></span><span>aPosition,&#xA0;</span><span class=\"constant numeric c\"><span>1.0</span></span><span>);</span></span></span></span></div><div class=\"line\"><span class=\"source glsl\"><span class=\"meta function c\"><span class=\"meta block c\"><span>&#xA0;&#xA0;&#xA0;&#xA0;vOcclusion&#xA0;=&#xA0;aOcclusion;</span></span></span></span></div><div class=\"line\"><span class=\"source glsl\"><span class=\"meta function c\"><span class=\"meta block c\"><span class=\"punctuation section block end c\"><span>}</span></span></span></span></span></div>\n</code></pre>\n<h3 id=\"fragment-shader\">Fragment Shader</h3>\n<pre><code class=\"lang-glsl\"><div class=\"line\"><span class=\"source glsl\"><span class=\"storage modifier glsl\"><span>varying</span></span><span>&#xA0;</span><span class=\"storage type glsl\"><span>float</span></span><span>&#xA0;vOcclusion;</span></span></div><div class=\"line\"><span class=\"source glsl\"><span>&#xA0;</span></span></div><div class=\"line\"><span class=\"source glsl\"><span class=\"storage type glsl\"><span>void</span></span><span class=\"meta function c\"><span class=\"punctuation whitespace function leading c\"><span>&#xA0;</span></span><span class=\"entity name function c\"><span>main</span></span><span class=\"meta parens c\"><span class=\"punctuation section parens begin c\"><span>(</span></span><span class=\"punctuation section parens end c\"><span>)</span></span></span><span>&#xA0;</span><span class=\"meta block c\"><span class=\"punctuation section block begin c\"><span>{</span></span></span></span></span></div><div class=\"line\"><span class=\"source glsl\"><span class=\"meta function c\"><span class=\"meta block c\"><span>&#xA0;&#xA0;&#xA0;&#xA0;</span><span class=\"support variable glsl\"><span>gl_FragColor</span></span><span>&#xA0;=</span><span class=\"meta function-call c\"><span class=\"punctuation whitespace function-call leading c\"><span>&#xA0;</span></span><span class=\"support function any-method c\"><span>vec4</span></span><span>(</span></span><span>vOcclusion,vOcclusion,vOcclusion,&#xA0;</span><span class=\"constant numeric c\"><span>1</span></span><span>);</span></span></span></span></div><div class=\"line\"><span class=\"source glsl\"><span class=\"meta function c\"><span class=\"meta block c\"><span class=\"punctuation section block end c\"><span>}</span></span></span></span></span></div>\n</code></pre>\n<h2 id=\"api\">API</h2>\n<pre><code class=\"lang-js\"><div class=\"line\"><span class=\"source js\"><span class=\"storage type var js\"><span>var</span></span><span>&#xA0;GeoAO&#xA0;</span><span class=\"keyword operator assignment js\"><span>=</span></span><span>&#xA0;</span><span class=\"support function js\"><span>require</span></span><span class=\"meta brace round js\"><span>(</span></span><span class=\"string quoted single js\"><span class=\"punctuation definition string begin js\"><span>&apos;</span></span><span>geo-ambient-occlusion</span><span class=\"punctuation definition string end js\"><span>&apos;</span></span></span><span class=\"meta brace round js\"><span>)</span></span></span></div>\n</code></pre>\n<h3 id=\"constructor\">Constructor</h3>\n<h4 id=\"-var-aosampler-new-geoao-positions-opts-\"><code>var aoSampler = new GeoAO(positions[, opts])</code></h4>\n<p><code>positions</code> is the vertex array for your mesh. It can be any of:</p>\n<ul>\n<li>Flat array <code>[1,2,3,4,5,6]</code></li>\n<li>Array of arrays <code>[[1,2,3], [4,5,6]]</code></li>\n<li>Array of TypedArrays <code>[new Float32Array([1,2,3]), new Float32Array([4,5,6])]</code></li>\n<li>TypedArray <code>new Float32Array([1,2,3,4,5,6])</code></li>\n<li><a href=\"https://www.npmjs.com/package/ndarray\">ndarray</a> <code>ndarray(new Float32Array([1,2,3,4,5,6]))</code></li>\n</ul>\n<p><code>opts</code> is an object that can have the following properties:</p>\n<ul>\n<li><code>resolution</code> (int) is the resolution to build the depth buffer at. Defaults to <code>256</code>.</li>\n<li><code>bias</code> (float) is the bias applied to the shadow map while building the ambient occlusion data. Defaults to <code>0.01</code>.</li>\n<li><code>cells</code> is the index data for your mesh, if you&apos;re using a <a href=\"https://github.com/mikolalysenko/simplicial-complex\">simplicial complex</a>. Defaults to <code>null</code>.</li>\n</ul>\n<h3 id=\"methods\">Methods</h3>\n<h4 id=\"-var-ao-aosampler-sample-nsamples-\"><code>var ao = aoSampler.sample(nSamples)</code></h4>\n<p>Performs <code>nSamples</code> (int) iterations of ambient occlusion sampling on the mesh positions provided in the constructor.\nReturns a flat Float32Array of shading values (1.0 - occlusion) that you can immediately consume as an attribute in your shader\nprogram.</p>\n<p>Since a fully converged AO calculation can take on the order of seconds or more even on modern GPUs, <code>geo-ambient-occlusion</code>\nallows you to split up the work between multiple calls to this function so that you can provide progress feedback to\nyour user. If you don&apos;t need to do this, you can simply set <code>nSamples</code> to the total number of samples you want to take.</p>\n"}