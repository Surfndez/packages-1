<h1 id="gl-state">gl-state</h1>
<p>Preserves WebGL state variables using a stack. This gives similar capabilities to OpenGL 1.0&apos;s pushAttrib/popAttrib, only with finer control over the variables which are stored. These methods are useful when writing simple hierarchical rendering functions, or for debugging operations in the middle of the pipeline.</p>
<h1 id="example">Example</h1>
<pre><code class="lang-javascript"><span class="kd">var</span> <span class="nx">shell</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;gl-now&quot;</span><span class="p">)()</span>
<span class="kd">var</span> <span class="nx">createStateStack</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;gl-state&quot;</span><span class="p">)</span>

<span class="kd">var</span> <span class="nx">stack</span>

<span class="nx">shell</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;gl-init&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>

  <span class="c1">//Create stack for saving state</span>
  <span class="nx">stack</span> <span class="o">=</span> <span class="nx">createStateStack</span><span class="p">(</span><span class="nx">shell</span><span class="p">.</span><span class="nx">gl</span><span class="p">)</span>

  <span class="c1">//Push variables onto stack here</span>
  <span class="nx">stack</span><span class="p">.</span><span class="nx">push</span><span class="p">()</span>
  <span class="c1">//... clobber stuff here ...</span>
  <span class="nx">shell</span><span class="p">.</span><span class="nx">gl</span><span class="p">.</span><span class="nx">clearColor</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

  <span class="c1">//Context states can also be nested</span>
  <span class="nx">stack</span><span class="p">.</span><span class="nx">push</span><span class="p">()</span>
  <span class="c1">// ... clobbber more stuff</span>
  <span class="nx">shell</span><span class="p">.</span><span class="nx">gl</span><span class="p">.</span><span class="nx">clearColor</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
  <span class="nx">stack</span><span class="p">.</span><span class="nx">pop</span><span class="p">()</span>

  <span class="c1">//Color back to previous value</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">shell</span><span class="p">.</span><span class="nx">gl</span><span class="p">.</span><span class="nx">getParameter</span><span class="p">(</span><span class="nx">shell</span><span class="p">.</span><span class="nx">gl</span><span class="p">.</span><span class="nx">COLOR_CLEAR_VALUE</span><span class="p">))</span>

  <span class="c1">//Restore state</span>
  <span class="nx">stack</span><span class="p">.</span><span class="nx">pop</span><span class="p">()</span>

  <span class="c1">//Now state is completely restored</span>
<span class="p">})</span>
</code></pre>
<h1 id="install">Install</h1>
<pre><code>npm install gl-state
</code></pre><h1 id="api">API</h1>
<h2 id="constructor">Constructor</h2>
<h3 id="-var-stack-require-gl-state-gl-variables-"><code>var stack = require(&quot;gl-state&quot;)(gl[, variables])</code></h3>
<p>Constructs a new state stack object that saves some subset of the global WebGL state for the context <code>gl</code></p>
<ul>
<li><code>gl</code> is a WebGL context</li>
<li><code>variables</code> is an optional list of state variables as defined in the specification of <a href="http://www.khronos.org/registry/webgl/specs/latest/1.0/#5.14.3"><code>gl.getParameter</code></a>. If not specified, the entire state will be saved</li>
</ul>
<p><strong>Returns</strong> A new WebGL state stack object</p>
<p><strong>Note on performance</strong> Modifying the WebGL state is expensive, especially if you update more of it. In general, you should avoid creating too many full context state changes. To do this, you should only specify a list of variables which you plan on actually modifying in the course of your code.  For example, to save only state variables associated with the depth buffer, you could do the following:</p>
<pre><code class="lang-javascript"><span class="kd">var</span> <span class="nx">depthStack</span> <span class="o">=</span> <span class="nx">createStack</span><span class="p">(</span><span class="nx">gl</span><span class="p">,</span> <span class="p">[</span>
  <span class="nx">gl</span><span class="p">.</span><span class="nx">DEPTH_CLEAR_VALUE</span><span class="p">,</span>
  <span class="nx">gl</span><span class="p">.</span><span class="nx">DEPTH_RANGE</span><span class="p">,</span>
  <span class="nx">gl</span><span class="p">.</span><span class="nx">DEPTH_TEST</span><span class="p">,</span>
  <span class="nx">gl</span><span class="p">.</span><span class="nx">DEPTH_WRITEMASK</span>
<span class="p">])</span>
</code></pre>
<p>In this way you don&apos;t have to save and update more of the WebGL context than is necessary.</p>
<p><strong>Note on textures</strong> Also the texture unit state is handled in a slightly different way. To specify saving the texture state, you can do:</p>
<pre><code class="lang-javascript"><span class="kd">var</span> <span class="nx">textureStack</span> <span class="o">=</span> <span class="nx">createStack</span><span class="p">(</span><span class="nx">gl</span><span class="p">,</span> <span class="p">[</span>
  <span class="nx">gl</span><span class="p">.</span><span class="nx">TEXTURE</span><span class="p">,</span>
  <span class="nx">gl</span><span class="p">.</span><span class="nx">ACTIVE_TEXTURE</span>
<span class="p">])</span>
</code></pre>
<p>This will save the texture state associated to all currently active texture units.</p>
<p><strong>Note on support</strong> Currently support for saving the state of shaders, uniforms and attributes is somewhat limited. If you are using these features and want to preserve the state of the rendering context you must do this yourself.</p>
<h2 id="methods">Methods</h2>
<p>The following methods are exposed by the stack object:</p>
<h3 id="-stack-push-"><code>stack.push()</code></h3>
<p>Saves the current state of the WebGL context onto the stack</p>
<h3 id="-stack-pop-"><code>stack.pop()</code></h3>
<p>Restores the last pushed state from the stack.</p>
<h1 id="credits">Credits</h1>
<p>(c) 2014 Mikola Lysenko. MIT License</p>
