<h1 id="glsl-perturb-normal"><a target="_blank" href="http://github.com/stackgl/glsl-perturb-normal">glsl-perturb-normal</a></h1>
<p><a href="http://github.com/badges/stability-badges"></a></p>
<p><img src="http://i.imgur.com/RCn9tjK.jpg" alt="demo-image"></p>
<p><a href="http://stack.gl/glsl-perturb-normal/demo">(click for demo)</a></p>
<iframe scrolling="no" seamless="seamless" src="http://stack.gl/glsl-perturb-normal/demo"></iframe>

<p>Perturb a normal in the fragment shader using a normal map. This can be used to add surface detail during per-pixel lighting. </p>
<p><em>Note:</em> You need to enable <code>GL_OES_standard_derivatives</code>.</p>
<pre><code class="lang-glsl"><span class="cp">#extension GL_OES_standard_derivatives : enable</span>

<span class="k">varying</span> <span class="k">vec3</span> <span class="n">vNormal</span><span class="p">;</span>
<span class="k">varying</span> <span class="k">vec2</span> <span class="n">vUv</span><span class="p">;</span>
<span class="k">varying</span> <span class="k">vec3</span> <span class="n">vViewPosition</span><span class="p">;</span>

<span class="k">uniform</span> <span class="k">sampler2D</span> <span class="n">normalMap</span><span class="p">;</span>

<span class="cp">#pragma glslify: perturb = require(&apos;glsl-perturb-normal&apos;)</span>

<span class="k">void</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">//extract normal map from your texture</span>
  <span class="k">vec3</span> <span class="n">normalRGB</span> <span class="o">=</span> <span class="n">texture2D</span><span class="p">(</span><span class="n">normalMap</span><span class="p">,</span> <span class="n">vUv</span><span class="p">).</span><span class="n">rgb</span><span class="p">;</span>

  <span class="c1">//expand into -1.0 .. 1.0 range</span>
  <span class="k">vec3</span> <span class="n">normalMap</span> <span class="o">=</span> <span class="n">normalRGB</span> <span class="o">*</span> <span class="mf">2.0</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">;</span>

  <span class="c1">//get surface normal and camera-space position</span>
  <span class="k">vec3</span> <span class="n">N</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">vNormal</span><span class="p">);</span>
  <span class="k">vec3</span> <span class="n">V</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">vViewPosition</span><span class="p">);</span>

  <span class="c1">//perturb the normal</span>
  <span class="k">vec3</span> <span class="n">normal</span> <span class="o">=</span> <span class="n">perturb</span><span class="p">(</span><span class="n">normalMap</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">vUv</span><span class="p">);</span>

  <span class="c1">//... lighting</span>
<span class="p">}</span>
</code></pre>
<h2 id="usage">Usage</h2>
<p><a href="https://nodei.co/npm/glsl-perturb-normal/"></a></p>
<h4 id="-vec3-perturbed-perturb-vec3-m-vec3-n-vec3-v-vec2-texcoord-"><code>vec3 perturbed = perturb(vec3 M, vec3 N, vec3 V, vec2 texcoord)</code></h4>
<p>Perturbs a normal where:</p>
<ul>
<li><code>M</code> is a unit vector from your normal map (e.g. decoded from a RGB texture)</li>
<li><code>N</code> is the normalized surface normal</li>
<li><code>V</code> is the normalized camera-space position</li>
<li><code>texcoord</code> is the UV coordinates of your mesh</li>
</ul>
<p>This uses <code>GL_OES_standard_derivatives</code> to compute the derivatives, so it may not work on older or low-end devices. </p>
<h2 id="credits">Credits</h2>
<p>The algorithm here is from Chris&#xAD;t&#xAD;ian Sch&#xFC;ler&apos;s blog post <a href="http://www.thetenthplanet.de/archives/1180">Normal Mapping Without Precomputed Tangents</a>.</p>
<h2 id="license">License</h2>
<p>MIT. See <a href="http://github.com/stackgl/glsl-perturb-normal/blob/master/LICENSE.md">LICENSE.md</a> for details.</p>
