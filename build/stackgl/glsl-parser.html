<h1 id="glsl-parser">glsl-parser</h1>
<p>


</p>
<p>A GLSL parser that takes tokens from
<a href="http://github.com/stackgl/glsl-tokenizer">glsl-tokenizer</a> and turns them into
an AST.</p>
<p>May either be used synchronously or as a stream.</p>
<h2 id="api">API</h2>
<h3 id="-stream-require-glsl-parser-stream-"><code>stream = require(&apos;glsl-parser/stream&apos;)</code></h3>
<p>Creates a GLSL parser stream, which emits nodes as they&apos;re parsed.</p>
<pre><code class="lang-javascript"><span class="kd">var</span> <span class="nx">TokenStream</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&apos;glsl-tokenizer/stream&apos;</span><span class="p">)</span>
<span class="kd">var</span> <span class="nx">ParseStream</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&apos;glsl-parser/stream&apos;</span><span class="p">)</span>
<span class="kd">var</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&apos;fs&apos;</span><span class="p">)</span>

<span class="nx">fs</span><span class="p">.</span><span class="nx">createReadStream</span><span class="p">(</span><span class="s1">&apos;test.glsl&apos;</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">TokenStream</span><span class="p">())</span>
  <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">ParseStream</span><span class="p">())</span>
  <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&apos;data&apos;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&apos;ast of&apos;</span><span class="p">,</span> <span class="nx">x</span><span class="p">.</span><span class="nx">type</span><span class="p">)</span>
  <span class="p">})</span>
</code></pre>
<h3 id="-ast-stream-program-"><code>ast = stream.program</code></h3>
<p>The full program&apos;s AST, which will be updated with each incoming token.</p>
<h3 id="-ast-require-glsl-parser-direct-tokens-"><code>ast = require(&apos;glsl-parser/direct&apos;)(tokens)</code></h3>
<p>Synchronously parses an array of tokens from <code>glsl-tokenizer</code>.</p>
<pre><code class="lang-javascript"><span class="kd">var</span> <span class="nx">TokenString</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&apos;glsl-tokenizer/string&apos;</span><span class="p">)</span>
<span class="kd">var</span> <span class="nx">ParseTokens</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&apos;glsl-parser/direct&apos;</span><span class="p">)</span>
<span class="kd">var</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&apos;fs&apos;</span><span class="p">)</span>

<span class="kd">var</span> <span class="nx">src</span> <span class="o">=</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="s1">&apos;test.glsl&apos;</span><span class="p">,</span> <span class="s1">&apos;utf8&apos;</span><span class="p">)</span>
<span class="kd">var</span> <span class="nx">tokens</span> <span class="o">=</span> <span class="nx">TokenString</span><span class="p">(</span><span class="nx">src</span><span class="p">)</span>
<span class="kd">var</span> <span class="nx">ast</span> <span class="o">=</span> <span class="nx">ParseTokens</span><span class="p">(</span><span class="nx">tokens</span><span class="p">)</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">ast</span><span class="p">)</span>
</code></pre>
<h2 id="nodes">Nodes</h2>
<ul>
<li><code>stmtlist</code></li>
<li><code>stmt</code></li>
<li><code>struct</code></li>
<li><code>function</code></li>
<li><code>functionargs</code></li>
<li><code>decl</code></li>
<li><code>decllist</code></li>
<li><code>forloop</code></li>
<li><code>whileloop</code></li>
<li><code>if</code></li>
<li><code>expr</code></li>
<li><code>precision</code></li>
<li><code>comment</code></li>
<li><code>preprocessor</code></li>
<li><code>keyword</code></li>
<li><code>ident</code></li>
<li><code>return</code></li>
<li><code>continue</code></li>
<li><code>break</code></li>
<li><code>discard</code></li>
<li><code>do-while</code></li>
<li><code>binary</code></li>
<li><code>ternary</code></li>
<li><code>unary</code></li>
</ul>
<h2 id="known-issues">Known Issues</h2>
<ul>
<li><p>because i am not smart enough to write a fully streaming parser, the current parser &quot;cheats&quot; a bit when it encounters a <code>expr</code> node! it actually waits until it has all the tokens it needs to build a tree for a given expression, then builds it and emits the constituent child nodes in the expected order. the <code>expr</code> parsing is heavily influenced by <a href="http://javascript.crockford.com/tdop/tdop.html">crockford&apos;s tdop article</a>. the rest of the parser is heavily influenced by fever dreams.</p>
</li>
<li><p>the parser might hit a state where it&apos;s looking at what <em>could be</em> an expression, or it could be a declaration --
that is, the statement starts with a previously declared <code>struct</code>. it&apos;ll opt to pretend it&apos;s a declaration, but that
might not be the case -- it might be a user-defined constructor starting a statement!</p>
</li>
<li><p>&quot;unhygenic&quot; <code>#if</code> / <code>#endif</code> macros are completely unhandled at the moment, since they&apos;re a bit of a pain.
if you&apos;ve got unhygenic macros in your code, move the #if / #endifs to statement level, and have them surround
wholly parseable code. this sucks, and i am sorry.</p>
</li>
</ul>
<h2 id="license">License</h2>
<p>MIT, see <a href="LICENSE.md">LICENSE.md</a> for more details.</p>
