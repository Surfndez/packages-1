<h1 id="gl-now">gl-now</h1>
<p>Create a WebGL context right now!</p>
<p>This module is an extension of <a href="https://github.com/mikolalysenko/game-shell">game-shell</a> that creates a WebGL enabled canvas and adds it to the specified container.</p>
<h2 id="example">Example</h2>
<p><a href="http://mikolalysenko.github.io/gl-now/">Try this demo in your browser</a></p>
<pre><code class="lang-javascript"><span class="c1">//Initialize shell</span>
<span class="kd">var</span> <span class="nx">shell</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;gl-now&quot;</span><span class="p">)()</span>

<span class="nx">shell</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;gl-init&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">gl</span> <span class="o">=</span> <span class="nx">shell</span><span class="p">.</span><span class="nx">gl</span>

  <span class="c1">//Create fragment shader</span>
  <span class="kd">var</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">createShader</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">FRAGMENT_SHADER</span><span class="p">)</span>
  <span class="nx">gl</span><span class="p">.</span><span class="nx">shaderSource</span><span class="p">(</span><span class="nx">fs</span><span class="p">,</span> <span class="p">[</span>
    <span class="s2">&quot;void main() {&quot;</span><span class="p">,</span>
      <span class="s2">&quot;gl_FragColor = vec4(1, 0, 0, 1);&quot;</span><span class="p">,</span>
    <span class="s2">&quot;}&quot;</span><span class="p">].</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;\n&quot;</span><span class="p">))</span>
  <span class="nx">gl</span><span class="p">.</span><span class="nx">compileShader</span><span class="p">(</span><span class="nx">fs</span><span class="p">)</span>

  <span class="c1">//Create vertex shader</span>
  <span class="kd">var</span> <span class="nx">vs</span> <span class="o">=</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">createShader</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">VERTEX_SHADER</span><span class="p">)</span>
  <span class="nx">gl</span><span class="p">.</span><span class="nx">shaderSource</span><span class="p">(</span><span class="nx">vs</span><span class="p">,</span> <span class="p">[</span>
    <span class="s2">&quot;attribute vec3 position;&quot;</span><span class="p">,</span>
    <span class="s2">&quot;void main() {&quot;</span><span class="p">,</span>
      <span class="s2">&quot;gl_Position = vec4(position, 1.0);&quot;</span><span class="p">,</span>
    <span class="s2">&quot;}&quot;</span><span class="p">].</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;\n&quot;</span><span class="p">))</span>
  <span class="nx">gl</span><span class="p">.</span><span class="nx">compileShader</span><span class="p">(</span><span class="nx">vs</span><span class="p">)</span>

  <span class="c1">//Link</span>
  <span class="kd">var</span> <span class="nx">shader</span> <span class="o">=</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">createProgram</span><span class="p">()</span>
  <span class="nx">gl</span><span class="p">.</span><span class="nx">attachShader</span><span class="p">(</span><span class="nx">shader</span><span class="p">,</span> <span class="nx">fs</span><span class="p">)</span>
  <span class="nx">gl</span><span class="p">.</span><span class="nx">attachShader</span><span class="p">(</span><span class="nx">shader</span><span class="p">,</span> <span class="nx">vs</span><span class="p">)</span>
  <span class="nx">gl</span><span class="p">.</span><span class="nx">linkProgram</span><span class="p">(</span><span class="nx">shader</span><span class="p">)</span>
  <span class="nx">gl</span><span class="p">.</span><span class="nx">useProgram</span><span class="p">(</span><span class="nx">shader</span><span class="p">)</span>

  <span class="c1">//Create buffer</span>
  <span class="nx">gl</span><span class="p">.</span><span class="nx">bindBuffer</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">ARRAY_BUFFER</span><span class="p">,</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">createBuffer</span><span class="p">())</span>
  <span class="nx">gl</span><span class="p">.</span><span class="nx">bufferData</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">ARRAY_BUFFER</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Float32Array</span><span class="p">([</span>
    <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
    <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
    <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span>
  <span class="p">]),</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">STATIC_DRAW</span><span class="p">)</span>

  <span class="c1">//Set up attribute pointer</span>
  <span class="kd">var</span> <span class="nx">position_attribute</span> <span class="o">=</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">getAttribLocation</span><span class="p">(</span><span class="nx">shader</span><span class="p">,</span> <span class="s2">&quot;position&quot;</span><span class="p">)</span>
  <span class="nx">gl</span><span class="p">.</span><span class="nx">enableVertexAttribArray</span><span class="p">(</span><span class="nx">position_attribute</span><span class="p">)</span>
  <span class="nx">gl</span><span class="p">.</span><span class="nx">vertexAttribPointer</span><span class="p">(</span><span class="nx">position_attribute</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">FLOAT</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="p">})</span>

<span class="nx">shell</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;gl-render&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">gl</span> <span class="o">=</span> <span class="nx">shell</span><span class="p">.</span><span class="nx">gl</span>

  <span class="c1">//Draw arrays</span>
  <span class="nx">gl</span><span class="p">.</span><span class="nx">drawArrays</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">TRIANGLES</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="p">})</span>

<span class="nx">shell</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;gl-error&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;WebGL not supported :(&quot;</span><span class="p">)</span>
<span class="p">})</span>
</code></pre>
<p>Result:</p>
<p><img src="https://raw.github.com/mikolalysenko/gl-now/master/screenshot.png"></p>
<h2 id="install">Install</h2>
<pre><code>npm install gl-now
</code></pre><h1 id="api">API</h1>
<h3 id="-var-shell-require-gl-now-options-"><code>var shell = require(&quot;gl-now&quot;)([options])</code></h3>
<p>Options is an object that takes the same fields as in <a href="https://github.com/mikolalysenko/game-shell#var-shell--requiregame-shelloptions">game-shell</a> with the following additions:</p>
<ul>
<li><code>clearFlags</code> a list of flags to clear on redraw.  (Default <code>gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT</code>)</li>
<li><code>clearColor</code> a length 4 array representing background clear color.  (Defaults to element&apos;s background-color or else <code>[0.2, 0.4, 0.8, 1.0]</code></li>
<li><code>clearDepth</code> value to clear depth buffer to (Defaults to <code>1.0</code>)</li>
<li><code>clearStencil</code> value to clear stencil buffer to (Defaults to <code>0</code>)</li>
<li><code>extensions</code> a list of necessary WebGL extensions to support.  Vendor prefix optional.  You can access these extensions later using <a href="https://npmjs.org/package/webglew">webglew</a></li>
<li><code>glOptions</code> on object containing a set of parameters which are passed to the webgl context directly.</li>
</ul>
<h2 id="events">Events</h2>
<p>In addition to all the events inherited from <a href="https://github.com/mikolalysenko/game-shell#events">game-shell</a>, <code>gl-now</code> adds the following events:</p>
<h3 id="-gl-init-"><code>gl-init</code></h3>
<p>Called once the WebGL context is initialized</p>
<h3 id="-gl-render-frame_time-"><code>gl-render([frame_time])</code></h3>
<p>Called at the start of the WebGL frame.</p>
<h3 id="-gl-error-reason-"><code>gl-error(reason)</code></h3>
<p>Called if there was an error initializing webgl</p>
<h3 id="-gl-resize-width-height-"><code>gl-resize(width, height)</code></h3>
<p>Called when the WebGL window is resized</p>
<h2 id="properties">Properties</h2>
<p>Finally <code>gl-now</code> adds the following extra properties to <code>game-shell</code>:</p>
<h3 id="-shell-gl-"><code>shell.gl</code></h3>
<p>The WebGL context</p>
<h3 id="-shell-canvas-"><code>shell.canvas</code></h3>
<p>The canvas object</p>
<h3 id="-shell-width-"><code>shell.width</code></h3>
<p>The width of the gl context</p>
<h3 id="-shell-height-"><code>shell.height</code></h3>
<p>The height of the context</p>
<h3 id="-shell-scale-"><code>shell.scale</code></h3>
<p>The scale of the context, which defaults to 1. Set it to higher values for
a smaller viewport and faster rendering at the expense of quality.</p>
<h3 id="-shell-mouse-"><code>shell.mouse</code></h3>
<p>A length 2 vector giving the current coordinate of the mouse on the screen</p>
<h3 id="-shell-prevmouse-"><code>shell.prevMouse</code></h3>
<p>A length 2 vector giving the previous coordinate of the mouse on the screen</p>
<h1 id="credits">Credits</h1>
<p>(c) 2013 Mikola Lysenko. MIT License</p>
