<h1 id="camera-picking-ray"><a target="_blank" href="http://github.com/Jam3/camera-picking-ray">camera-picking-ray</a></h1>
<p><a href="http://github.com/badges/stability-badges"></a></p>
<p>Creates a picking ray for a camera. Commonly used for mouse interaction in 2D and 3D games.</p>
<p>The camera is assumed to have a <code>projection</code> and <code>view</code> matrix, which can be combined and inverted to form <code>invProjView</code>. </p>
<pre><code class="lang-js"><span class="kd">var</span> <span class="nx">origin</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<span class="kd">var</span> <span class="nx">direction</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

<span class="c1">//compute ray and store it in (origin, direction)</span>
<span class="nx">pick</span><span class="p">(</span><span class="nx">origin</span><span class="p">,</span> <span class="nx">direction</span><span class="p">,</span> <span class="nx">mouse</span><span class="p">,</span> <span class="nx">viewport</span><span class="p">,</span> <span class="nx">invProjView</span><span class="p">)</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">origin</span><span class="p">,</span> <span class="nx">direction</span><span class="p">)</span>
</code></pre>
<p>Full example, hit-testing against a 3D sphere:</p>
<pre><code class="lang-js"><span class="kd">var</span> <span class="nx">mat4</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&apos;gl-mat4&apos;</span><span class="p">)</span>
<span class="kd">var</span> <span class="nx">pick</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&apos;camera-picking-ray&apos;</span><span class="p">)</span>
<span class="kd">var</span> <span class="nx">intersect</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&apos;ray-sphere-intersection&apos;</span><span class="p">)</span>

<span class="c1">//your camera matrices</span>
<span class="kd">var</span> <span class="nx">projection</span> <span class="o">=</span> <span class="p">...</span>
<span class="kd">var</span> <span class="nx">view</span> <span class="o">=</span> <span class="p">...</span>
<span class="kd">var</span> <span class="nx">projView</span> <span class="o">=</span> <span class="nx">mat4</span><span class="p">.</span><span class="nx">multiply</span><span class="p">([],</span> <span class="nx">projection</span><span class="p">,</span> <span class="nx">view</span><span class="p">)</span>
<span class="kd">var</span> <span class="nx">invProjView</span> <span class="o">=</span> <span class="nx">mat4</span><span class="p">.</span><span class="nx">invert</span><span class="p">([],</span> <span class="nx">projView</span><span class="p">)</span>

<span class="kd">var</span> <span class="nx">mouse</span> <span class="o">=</span> <span class="p">[</span> <span class="nx">screenX</span><span class="p">,</span> <span class="nx">screenHeight</span> <span class="o">-</span> <span class="nx">screenY</span> <span class="p">]</span>
<span class="kd">var</span> <span class="nx">viewport</span> <span class="o">=</span> <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">screenWidth</span><span class="p">,</span> <span class="nx">screenHeight</span> <span class="p">]</span>

<span class="kd">var</span> <span class="nx">ray</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">ro</span><span class="o">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
  <span class="nx">rd</span><span class="o">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<span class="p">}</span>

<span class="c1">//store result in ray (origin, direction)</span>
<span class="nx">pick</span><span class="p">(</span><span class="nx">ray</span><span class="p">.</span><span class="nx">ro</span><span class="p">,</span> <span class="nx">ray</span><span class="p">.</span><span class="nx">rd</span><span class="p">,</span> <span class="nx">mouse</span><span class="p">,</span> <span class="nx">viewport</span><span class="p">,</span> <span class="nx">invProjView</span><span class="p">)</span>

<span class="c1">//let&apos;s see if the mouse hit a 3D sphere...</span>
<span class="kd">var</span> <span class="nx">center</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
    <span class="nx">radius</span> <span class="o">=</span> <span class="mf">1.5</span>
<span class="kd">var</span> <span class="nx">hit</span> <span class="o">=</span> <span class="nx">intersect</span><span class="p">([],</span> <span class="nx">ray</span><span class="p">.</span><span class="nx">ro</span><span class="p">,</span> <span class="nx">ray</span><span class="p">.</span><span class="nx">rd</span><span class="p">,</span> <span class="nx">center</span><span class="p">,</span> <span class="nx">radius</span><span class="p">)</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">hit</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Mouse hit the sphere at:&quot;</span><span class="p">,</span> <span class="nx">hit</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>
<p>PRs welcome.</p>
<h2 id="usage">Usage</h2>
<p><a href="https://www.npmjs.com/package/camera-picking-ray"></a></p>
<h4 id="-pick-origin-direction-mouse-viewport-invprojview-"><code>pick(origin, direction, mouse, viewport, invProjView)</code></h4>
<p>Creates a picking ray for the given <code>mouse</code> screen-space position (vec2) and <code>viewport</code> screen-space bounds (x, y, width, height). <code>invProjView</code> is the inverse of the combined <code>projection * view</code> matrix for your camera.</p>
<p>Stores the resulting ray in the first two parameters: <code>origin</code> (vec3) and <code>direction</code> (vec3).</p>
<h2 id="see-also">See Also</h2>
<ul>
<li><a href="https://www.npmjs.com/package/ray-sphere-intersection">ray-sphere-intersection</a></li>
<li><a href="https://www.npmjs.com/package/ray-triangle-intersection">ray-triangle-intersection</a></li>
<li><a href="https://www.npmjs.com/package/ray-plane-intersection">ray-plane-intersection</a></li>
<li><a href="https://www.npmjs.com/package/ray-aabb">ray-aabb</a></li>
<li><a href="https://www.npmjs.com/package/camera-unproject">camera-unproject</a></li>
</ul>
<h2 id="license">License</h2>
<p>MIT, see <a href="http://github.com/Jam3/camera-picking-ray/blob/master/LICENSE.md">LICENSE.md</a> for details.</p>
