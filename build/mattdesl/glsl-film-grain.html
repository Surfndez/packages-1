<h1 id="glsl-film-grain"><a target="_blank" href="http://github.com/mattdesl/glsl-film-grain">glsl-film-grain</a></h1>
<p><a href="http://github.com/badges/stability-badges"></a></p>
<p><iframe scrolling="no" seamless="seamless" src="http://mattdesl.github.io/glsl-film-grain/"></iframe></p>
<p><a href="http://mattdesl.github.io/glsl-film-grain">(click for demo)</a></p>
<p>Natural looking film grain using 3D noise functions. Inspired by <a href="http://devlog-martinsh.blogspot.ca/2013/05/image-imperfections-and-film-grain-post.html">Martins Upitis</a>. </p>
<p>This is a fairly expensive technique to achieve film grain, but it looks more realistic than a <a href="https://www.npmjs.com/package/glsl-random">hash function</a> and also produces better motion.</p>
<p>Simplest example:</p>
<pre><code class="lang-glsl"><span class="cp">#pragma glslify: grain = require(glsl-film-grain)</span>

<span class="k">void</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">float</span> <span class="n">grainSize</span> <span class="o">=</span> <span class="mf">2.0</span><span class="p">;</span>
    <span class="k">float</span> <span class="n">g</span> <span class="o">=</span> <span class="n">grain</span><span class="p">(</span><span class="n">texCoord</span><span class="p">,</span> <span class="n">resolution</span> <span class="o">/</span> <span class="n">grainSize</span><span class="p">);</span>
    <span class="k">vec3</span> <span class="n">color</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="n">g</span><span class="p">);</span>
    <span class="n">gl_FragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">);</span>
<span class="p">}</span>
</code></pre>
<p>Results in:</p>
<p><img src="http://i.imgur.com/OEBZs8B.png" alt="grain"></p>
<p>See <a href="#blending-tips">blending tips</a> and the <a href="demo.js">demo source</a> for details.</p>
<h2 id="usage">Usage</h2>
<p><a href="https://www.npmjs.com/package/glsl-film-grain"></a></p>
<h4 id="-f-grain-texcoord-resolution-frame-q-"><code>f = grain(texCoord, resolution[, frame[, q]])</code></h4>
<p>Returns a float for the monochromatic grain with the given options:</p>
<ul>
<li><code>texCoord</code> the UV coordinates of your scene</li>
<li><code>resolution</code> the resolution of your scene in pixels, optionally scaled to adjust the grain size</li>
<li><code>frame</code> the animation frame, which is an offset into the Z of the 3D noise</li>
<li><code>q</code> is a coefficient for the offset calculation, and may evoke subtly different motion. Defaults to 2.5</li>
</ul>
<h2 id="blending-tips">blending tips</h2>
<p>There are a lot of ways to blend the noise onto the 3D scene or image. The solution used in the demo uses <a href="https://www.npmjs.com/package/glsl-blend-soft-light">glsl-blend-soft-light</a> and <a href="https://www.npmjs.com/package/glsl-luma">glsl-luma</a>.</p>
<pre><code class="lang-glsl"><span class="k">vec3</span> <span class="n">g</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="n">grain</span><span class="p">(</span><span class="n">texCoord</span><span class="p">,</span> <span class="n">p</span><span class="p">));</span>

    <span class="c1">//blend the noise over the background, </span>
    <span class="c1">//i.e. overlay, soft light, additive</span>
    <span class="k">vec3</span> <span class="n">color</span> <span class="o">=</span> <span class="n">blend</span><span class="p">(</span><span class="n">backgroundColor</span><span class="p">,</span> <span class="n">g</span><span class="p">);</span>

    <span class="c1">//get the luminance of the background</span>
    <span class="k">float</span> <span class="n">luminance</span> <span class="o">=</span> <span class="n">luma</span><span class="p">(</span><span class="n">backgroundColor</span><span class="p">);</span>

    <span class="c1">//reduce the noise based on some </span>
    <span class="c1">//threshold of the background luminance</span>
    <span class="k">float</span> <span class="n">response</span> <span class="o">=</span> <span class="n">smoothstep</span><span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">luminance</span><span class="p">);</span>
    <span class="n">color</span> <span class="o">=</span> <span class="n">mix</span><span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="n">backgroundColor</span><span class="p">,</span> <span class="n">pow</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">));</span>

    <span class="c1">//final color</span>
    <span class="n">gl_FragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">);</span>
</code></pre>
<h2 id="license">License</h2>
<p>MIT, see <a href="http://github.com/mattdesl/glsl-film-grain/blob/master/LICENSE.md">LICENSE.md</a> for details.</p>
