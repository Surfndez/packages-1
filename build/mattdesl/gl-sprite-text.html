<h1 id="gl-sprite-text"><a target="_blank" href="http://github.com/mattdesl/gl-sprite-text">gl-sprite-text</a></h1>
<p><a href="http://github.com/badges/stability-badges"></a></p>
<p><img src="http://i.imgur.com/P5zUbNo.png" alt="text"></p>
<p>A solution for bitmap and <a href="http://www.valvesoftware.com/publications/2007/SIGGRAPH2007_AlphaTestedMagnification.pdf">SDF</a> text rendering in stack.gl. This uses <a href="https://nodei.co/npm/gl-sprite-batch/">gl-sprite-batch</a> and <a href="https://www.npmjs.org/package/fontpath-simple-renderer">fontpath</a> under the hood. </p>
<p>The <a href="https://www.npmjs.org/package/bmfont2json">BMFont spec</a> is used for glyph and font data. You also need to pass an array of <a href="https://www.npmjs.org/package/gl-texture2d">gl-texture2d</a> items matching the <code>paths</code> specified by the font file. (Multi-page fonts are supported.)</p>
<p>The <code>font</code> object can also include an <code>images</code> array (ndarray/HTMLImage), which will get piped into <code>gl-texture2d</code>.  You can use <a href="https://www.npmjs.org/package/bmfont-lato">bmfont-lato</a> for testing; it includes Lato Regular in a few sizes and the base64-inlined <code>images</code> ndarray.</p>
<pre><code class="lang-js"><span class="kd">var</span> <span class="nx">createText</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&apos;gl-sprite-text&apos;</span><span class="p">)</span>
<span class="kd">var</span> <span class="nx">Lato</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&apos;bmfont-lato&apos;</span><span class="p">)</span>

<span class="c1">//build the text</span>
<span class="nx">text</span> <span class="o">=</span> <span class="nx">createText</span><span class="p">(</span><span class="nx">gl</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">font</span><span class="o">:</span> <span class="nx">Lato</span><span class="p">,</span>
    <span class="nx">text</span><span class="o">:</span> <span class="s1">&apos;Hello, World!&apos;</span>
<span class="p">})</span>

<span class="c1">//optionally word-wrap it to a specific width</span>
<span class="nx">text</span><span class="p">.</span><span class="nx">layout</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>

<span class="kd">function</span> <span class="nx">render</span><span class="p">()</span> <span class="p">{</span> 
    <span class="c1">//draws the text with lower-left origin</span>
    <span class="nx">text</span><span class="p">.</span><span class="nx">draw</span><span class="p">(</span><span class="nx">shader</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>
<p>See <a href="demo/simple.js">demo/simple.js</a> for an example. After <code>npm install</code>, you can run it with:</p>
<p><code>npm run demo-simple</code></p>
<h2 id="tools">Tools</h2>
<p>After you&apos;ve exported the BMFont with <a href="https://github.com/libgdx/libgdx/wiki/Hiero">your favourite tool</a>, you can run it through <a href="https://www.npmjs.org/package/bmfont2json">bmfont2json</a> to produce valid output:</p>
<pre><code class="lang-sh"><span class="c"># if you haven&apos;t already, install the tool globally</span>
npm install bmfont2json -g

<span class="c"># then you can use it like so..</span>
bmfont2json Lato32.fnt &gt; Lato32.json
</code></pre>
<h2 id="signed-distance-fields">Signed Distance Fields</h2>
<p>Bitmap fonts are great for fixed-size text, but if you need large fonts, or fonts that scale smoothly (i.e. if it&apos;s being 3D transformed), it&apos;s better to use alpha testing to avoid aliasing artifacts. To generate SDF font atlases, you can use <a href="https://github.com/libgdx/libgdx/wiki/Distance-field-fonts">Hiero and LibGDX</a>. Then, you need to render it with a signed distance field shader. See the <a href="demo/sdf.js">demo/sdf.js</a> example:</p>
<p><code>npm run demo-sdf</code></p>
<p>As you can see from the demo, you can also achieve drop shadows, outlines, glows and other effects with independent colors. </p>
<h2 id="static-text">Static Text</h2>
<p>By default, the text is pushed to dynamic buffers every frame. This allows it to animate (e.g. changing position, start/end indices, text content), and also ensures that underlines and multi-page textures will work. </p>
<p>Basic static text is supported with the <code>cache()</code> method. Static text only supports a single texture page, and no underlines. </p>
<pre><code class="lang-js"><span class="kd">var</span> <span class="nx">text</span> <span class="o">=</span> <span class="nx">createText</span><span class="p">(</span><span class="nx">gl</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">font</span><span class="o">:</span> <span class="nx">myFont</span><span class="p">,</span>
    <span class="nx">textures</span><span class="o">:</span> <span class="nx">textures</span><span class="p">,</span>
    <span class="nx">text</span><span class="o">:</span> <span class="nx">str</span><span class="p">,</span>

    <span class="c1">//hint to buffers that they will be static</span>
    <span class="nx">dynamic</span><span class="o">:</span> <span class="kc">false</span>
<span class="p">})</span>

<span class="c1">//cache the current text state</span>
<span class="nx">text</span><span class="p">.</span><span class="nx">cache</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">start</span><span class="p">,</span> <span class="nx">end</span><span class="p">)</span>

<span class="kd">function</span> <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">text</span><span class="p">.</span><span class="nx">draw</span><span class="p">(</span><span class="nx">shader</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>
<h2 id="usage">Usage</h2>
<p><a href="https://nodei.co/npm/gl-sprite-text/"></a></p>
<p>Inherits from <code>fontpath-simple-renderer</code> so the API should work, but this module may diverge from it in the future. Here is the current public API:</p>
<h4 id="-text-createtext-opts-"><code>text = createText(opts)</code></h4>
<p>The following options can be provided:</p>
<ul>
<li><code>font</code> the bitmap font object, required</li>
<li><code>textures</code> an array of gl textures to match <code>font.paths</code>. If this is not specified, it will look for an <code>images</code> array in the <code>font</code> object, which can be ndarrays, HTMLImage objects, or anything that gets piped to <code>createTexture</code>.</li>
<li><code>text</code> the string of text we will be rendering, default to empty string</li>
<li><code>align</code> a string &apos;left&apos;, &apos;center&apos;, &apos;right&apos;, default left</li>
<li><code>underline</code> boolean, whether to underline the text, default false</li>
<li><code>underlinePosition</code> the position of underline in pixels, defaults to a fraction of font size</li>
<li><code>underlineThickness</code> the underline thickness in pixels, defaults to a fraction of font size</li>
<li><code>lineHeight</code> a line height in pixels, otherwise defaults to an automatic gap</li>
<li><code>letterSpacing</code> the letter spacing in pixels, default 0</li>
<li><code>wrapMode</code> can be <code>normal</code>, <code>pre</code>, or <code>nowrap</code>, default <code>normal</code></li>
<li><code>wrapWidth</code> an initial number in pixels which is passed to <code>layout()</code> after the other options have been set. Otherwise, defaults to no layout (a single line, no breaks)</li>
<li><code>capacity</code> an initial capacity to use for gl-sprite-batch</li>
<li><code>dynamic</code> whether the WebGL buffers should use <code>DYNAMIC_DRAW</code>, default true</li>
</ul>
<p>All options except for <code>font</code>, <code>wrapMode</code> and <code>wrapWidth</code> are fields which be changed at runtime, before calling <code>draw()</code>.</p>
<p><em>Note:</em> Changing the <code>text</code> currently calls <code>clearLayout()</code>. You will need to call <code>layout()</code> again. </p>
<h4 id="-text-draw-shader-x-y-start-end-"><code>text.draw(shader[, x, y, start, end])</code></h4>
<p>Draws the text with the given shader, at the specified pixel position (lower-left origin). </p>
<p>The <code>start</code> (inclusive) and <code>end</code> (exclusive) indices will draw the laid out glyphs within those bounds. This can be used to style and colour different pieces of text. If not specified, they will default to 0 and the text length, respectively.</p>
<p>If text is cached, the <code>x, y, start, end</code> parameters are ignored.</p>
<h4 id="-text-layout-wrapwidth-"><code>text.layout([wrapWidth])</code></h4>
<p>Word-wraps the text with the current wrap mode to the optional given width. You can change the wrap mode like so:</p>
<pre><code class="lang-js"><span class="nx">text</span><span class="p">.</span><span class="nx">wordwrap</span><span class="p">.</span><span class="nx">mode</span> <span class="o">=</span> <span class="s1">&apos;pre&apos;</span>
<span class="nx">text</span><span class="p">.</span><span class="nx">layout</span><span class="p">(</span><span class="mi">250</span><span class="p">)</span>
</code></pre>
<p>If no width is specified, it will only break on explicit newline characters <code>\n</code>.</p>
<p>This creates some new objects in memory, so you may not want to do it every frame. </p>
<h4 id="-text-clearlayout-"><code>text.clearLayout()</code></h4>
<p>Clears the current word-wrapping. This leads to a single line of text, no line-breaks. </p>
<h4 id="-text-getbounds-"><code>text.getBounds()</code></h4>
<p>Returns an object with the computed bounds of the text box:</p>
<p><code>{ x, y, width height }</code></p>
<p>This can be used to draw the text at an upper-left origin instead.</p>
<h4 id="-text-cache-x-y-start-end-"><code>text.cache([x, y, start, end])</code></h4>
<p>Caches the current text parameters into a static buffer. Underlines are not supported; and this only works with one texture page (e.g. all glyphs in a single sprite sheet).</p>
<p>The parameters replace those in <code>draw()</code>. When cached, <code>draw()</code> will ignore the <code>x, y, start, end</code> parameters.</p>
<h4 id="-text-uncache-"><code>text.uncache()</code></h4>
<p>Disables caching, allowing it to be animated dynamically again. </p>
<h4 id="-text-dispose-textures-"><code>text.dispose([textures])</code></h4>
<p>If no <code>batch</code> was provided during the constructor, this will dispose of the default (internally created) batch. </p>
<p>Specifying true for <code>textures</code> (default false) will also dispose of the texture array associated with this text object.</p>
<h2 id="license">License</h2>
<p>MIT, see <a href="http://github.com/mattdesl/gl-sprite-text/blob/master/LICENSE.md">LICENSE.md</a> for details.</p>
