<h1 id="glsl-extract-reflect"><a target="_blank" href="http://github.com/mattdesl/glsl-extract-reflect">glsl-extract-reflect</a></h1>
<p><a href="http://github.com/badges/stability-badges"></a></p>
<p>Takes the type data from <a href="https://www.npmjs.com/package/glsl-extract">glsl-extract</a> and transforms the names into a JSON structure where each leaf node is the return value of the given <code>map</code> function.</p>
<p>This is useful to create wrappers for uniform and attribute structs/arrays.</p>
<pre><code class="lang-js"><span class="kd">var</span> <span class="nx">reflect</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&apos;glsl-extract-reflect&apos;</span><span class="p">)</span>

<span class="kd">var</span> <span class="nx">uniforms</span> <span class="o">=</span> <span class="p">[</span>
  <span class="p">{</span> <span class="nx">name</span><span class="o">:</span> <span class="s1">&apos;lights[0].position&apos;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span> <span class="s1">&apos;vec4&apos;</span> <span class="p">},</span>
  <span class="p">{</span> <span class="nx">name</span><span class="o">:</span> <span class="s1">&apos;projection&apos;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span> <span class="s1">&apos;mat4&apos;</span> <span class="p">},</span>
  <span class="p">{</span> <span class="nx">name</span><span class="o">:</span> <span class="s1">&apos;color&apos;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span> <span class="s1">&apos;vec3&apos;</span> <span class="p">}</span>
<span class="p">]</span>

<span class="kd">var</span> <span class="nx">locations</span> <span class="o">=</span> <span class="nx">reflect</span><span class="p">(</span><span class="nx">uniforms</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">uniform</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">{</span>
    <span class="nx">type</span><span class="o">:</span> <span class="nx">uniform</span><span class="p">.</span><span class="nx">type</span><span class="p">,</span>
    <span class="nx">location</span><span class="o">:</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">getUniformLocation</span><span class="p">(</span><span class="nx">program</span><span class="p">,</span> <span class="nx">uniform</span><span class="p">.</span><span class="nx">path</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">})</span>
</code></pre>
<p>The <code>locations</code> result looks like this:</p>
<pre><code class="lang-js"><span class="p">{</span>
  <span class="s2">&quot;lights&quot;</span><span class="o">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="s2">&quot;position&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;vec4&quot;</span><span class="p">,</span>
        <span class="s2">&quot;location&quot;</span><span class="o">:</span> <span class="nx">WebGLUniformLocation</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">],</span>
  <span class="s2">&quot;projection&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;mat4&quot;</span><span class="p">,</span>
    <span class="s2">&quot;location&quot;</span><span class="o">:</span> <span class="nx">WebGLUniformLocation</span>
  <span class="p">},</span>
  <span class="s2">&quot;color&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;vec3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;location&quot;</span><span class="o">:</span> <span class="nx">WebGLUniformLocation</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<p>Credit goes to @mikolalysenko; this was pulled out of <a href="https://github.com/stackgl/gl-shader">gl-shader</a> and made a little more generic.</p>
<h2 id="usage">Usage</h2>
<p><a href="https://www.npmjs.com/package/glsl-extract-reflect"></a></p>
<h4 id="-result-reflect-array-map-"><code>result = reflect(array, map)</code></h4>
<p>Takes an <code>array</code> of uniforms or attributes with <code>{ name, type }</code> values, and returns the &quot;unflattened&quot; object for all structs and arrays. Each leaf node is the result of calling <code>map(data, index, array)</code>, where <code>data</code> has the following:</p>
<pre><code class="lang-js"><span class="p">{</span>
  <span class="nx">name</span><span class="o">:</span> <span class="s1">&apos;radius&apos;</span>           <span class="c1">// the standalone uniform name</span>
  <span class="nx">path</span><span class="o">:</span> <span class="s1">&apos;lights[0].radius&apos;</span> <span class="c1">// the qualified name used by WebGL</span>
  <span class="nx">type</span><span class="o">:</span> <span class="s1">&apos;float&apos;</span>            <span class="c1">// the original type</span>
  <span class="p">...</span>
<span class="p">}</span>
</code></pre>
<p>Other values (like <code>location</code>) are also copied into the <code>data</code> object.</p>
<h2 id="see-also">See Also</h2>
<ul>
<li><a href="https://www.npmjs.com/package/glsl-extract-sync">glsl-extract-sync</a></li>
<li><a href="https://www.npmjs.com/package/gl-shader-extract">gl-shader-extract</a> (extracts during runtime)</li>
</ul>
<h2 id="license">License</h2>
<p>MIT, see <a href="http://github.com/mattdesl/glsl-extract-reflect/blob/master/LICENSE.md">LICENSE.md</a> for details.</p>
