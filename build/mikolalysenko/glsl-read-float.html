<h1 id="glsl-read-float">glsl-read-float</h1>
<p>Workaround for reading floating point values back from the GPU using GLSL.</p>
<h2 id="example">Example</h2>
<pre><code class="lang-javascript"><span class="kd">var</span> <span class="nx">triangle</span>     <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&apos;a-big-triangle&apos;</span><span class="p">)</span>
<span class="kd">var</span> <span class="nx">fit</span>          <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&apos;canvas-fit&apos;</span><span class="p">)</span>
<span class="kd">var</span> <span class="nx">getContext</span>   <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&apos;gl-context&apos;</span><span class="p">)</span>
<span class="kd">var</span> <span class="nx">glslify</span>      <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&apos;glslify&apos;</span><span class="p">)</span>
<span class="kd">var</span> <span class="nx">unpackFloat</span>  <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;glsl-read-float&quot;</span><span class="p">)</span>

<span class="kd">var</span> <span class="nx">canvas</span>     <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&apos;canvas&apos;</span><span class="p">))</span>
<span class="kd">var</span> <span class="nx">gl</span>         <span class="o">=</span> <span class="nx">getContext</span><span class="p">(</span><span class="nx">canvas</span><span class="p">,</span> <span class="nx">render</span><span class="p">)</span>

<span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&apos;resize&apos;</span><span class="p">,</span> <span class="nx">fit</span><span class="p">(</span><span class="nx">canvas</span><span class="p">),</span> <span class="kc">false</span><span class="p">)</span>

<span class="kd">var</span> <span class="nx">shader</span> <span class="o">=</span> <span class="nx">glslify</span><span class="p">({</span>
  <span class="nx">vert</span><span class="o">:</span> <span class="s2">&quot;\</span>
<span class="s2">attribute vec2 position;\</span>
<span class="s2">void main() {\</span>
<span class="s2">  gl_Position = vec4(position, 0, 1);\</span>
<span class="s2">}&quot;</span><span class="p">,</span>
  <span class="nx">frag</span><span class="o">:</span> <span class="s2">&quot;\</span>
<span class="s2">#pragma glslify: packFloat = require(glsl-read-float)\n\</span>
<span class="s2">uniform highp float f;\</span>
<span class="s2">void main() {\</span>
<span class="s2">  gl_FragColor = packFloat(f);\</span>
<span class="s2">}&quot;</span><span class="p">,</span>
  <span class="nx">inline</span><span class="o">:</span> <span class="kc">true</span>
<span class="p">})(</span><span class="nx">gl</span><span class="p">)</span>

<span class="kd">function</span> <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">num</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span>

  <span class="c1">//Draw shader</span>
  <span class="nx">shader</span><span class="p">.</span><span class="nx">bind</span><span class="p">()</span>
  <span class="nx">shader</span><span class="p">.</span><span class="nx">uniforms</span><span class="p">.</span><span class="nx">f</span> <span class="o">=</span> <span class="nx">num</span>
  <span class="nx">triangle</span><span class="p">(</span><span class="nx">gl</span><span class="p">)</span>

  <span class="c1">//Read back the float</span>
  <span class="kd">var</span> <span class="nx">buffer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Uint8Array</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
  <span class="nx">gl</span><span class="p">.</span><span class="nx">readPixels</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">RGBA</span><span class="p">,</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">UNSIGNED_BYTE</span><span class="p">,</span> <span class="nx">buffer</span><span class="p">)</span>
  <span class="kd">var</span> <span class="nx">unpacked</span> <span class="o">=</span> <span class="nx">unpackFloat</span><span class="p">(</span><span class="nx">buffer</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">buffer</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nx">buffer</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="nx">buffer</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>

  <span class="c1">//Log output to console</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;expected:&quot;</span><span class="p">,</span> <span class="nx">num</span><span class="p">,</span> <span class="s2">&quot;got:&quot;</span><span class="p">,</span> <span class="nx">unpacked</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>
<h2 id="install">Install</h2>
<pre><code>npm install glsl-read-float
</code></pre><h2 id="api">API</h2>
<h3 id="glsl">GLSL</h3>
<pre><code class="lang-glsl"><span class="cp">#pragma glslify: packFloat = require(glsl-read-float)</span>
</code></pre>
<h4 id="-vec4-packed-packfloat-float-f-"><code>vec4 packed = packFloat(float f)</code></h4>
<p>Packs a floating point number into an 8bit RGBA color vector, which can be written to the display using <code>gl_FragColor</code>, for example.</p>
<ul>
<li><code>f</code> is a <code>float</code> number</li>
</ul>
<p><strong>Returns</strong> A packed <code>vec4</code> encoding the value of <code>f</code></p>
<h3 id="javascript">JavaScript</h3>
<pre><code class="lang-javascript"><span class="kd">var</span> <span class="nx">unpackFloat</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;glsl-read-float&quot;</span><span class="p">)</span>
</code></pre>
<h4 id="-var-f-unpackfloat-x-y-z-w-"><code>var f = unpackFloat(x, y, z, w)</code></h4>
<p>Unpacks a packed <code>vec4</code> into a single floating point value.</p>
<ul>
<li><code>x</code> is the first component of the packed float</li>
<li><code>y</code> is the second component of the packed float</li>
<li><code>z</code> is the third component of the packed float</li>
<li><code>w</code> is the fourth component of the packed float</li>
</ul>
<p><strong>Returns</strong> A number which is the unpacked value of the floating point input.</p>
<p><strong>Note</strong> This module doesn&apos;t handle denormals or floats larger than <code>Math.pow(2, 127)</code></p>
<h2 id="credits">Credits</h2>
<p>Originally based on a routine by @ultraist. You can find his blog here: <a href="http://ultraist.hatenablog.com/">http://ultraist.hatenablog.com/</a></p>
<p>Newer version rewritten by Mikola Lysenko.  MIT License (c) 2014</p>
