<h1 id="gl-scatter-plot">gl-scatter-plot</h1>
<p>3D WebGL scatter plots with custom point glyphs.</p>
<p><iframe scrolling="no" seamless="seamless" src="http://mikolalysenko.github.io/gl-scatter-plot/"></iframe></p>
<h1 id="example">Example</h1>
<pre><code class="lang-javascript"><span class="kd">var</span> <span class="nx">shell</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;gl-now&quot;</span><span class="p">)({</span><span class="nx">tickRate</span><span class="o">:</span> <span class="mi">2</span><span class="p">})</span>
<span class="kd">var</span> <span class="nx">camera</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;game-shell-orbit-camera&quot;</span><span class="p">)(</span><span class="nx">shell</span><span class="p">)</span>
<span class="kd">var</span> <span class="nx">createPoints</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;gl-scatter-plot&quot;</span><span class="p">)</span>
<span class="kd">var</span> <span class="nx">createAxes</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;gl-axes&quot;</span><span class="p">)</span>
<span class="kd">var</span> <span class="nx">createSelect</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;gl-select&quot;</span><span class="p">)</span>
<span class="kd">var</span> <span class="nx">mat4</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;gl-matrix&quot;</span><span class="p">).</span><span class="nx">mat4</span>

<span class="kd">var</span> <span class="nx">points</span><span class="p">,</span> <span class="nx">axes</span><span class="p">,</span> <span class="nx">select</span>

<span class="nx">camera</span><span class="p">.</span><span class="nx">lookAt</span><span class="p">(</span>
  <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span>
  <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">],</span>
  <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>

<span class="nx">shell</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;gl-init&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">gl</span> <span class="o">=</span> <span class="nx">shell</span><span class="p">.</span><span class="nx">gl</span>

  <span class="c1">//Initialize point cloud</span>
  <span class="kd">var</span> <span class="nx">initialData</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">position</span><span class="o">:</span> <span class="p">[</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="p">],</span>
    <span class="nx">glyph</span><span class="o">:</span> <span class="p">[</span>  <span class="s2">&quot;&#x25BC;&quot;</span><span class="p">,</span> <span class="s2">&quot;&#x2605;&quot;</span><span class="p">,</span> <span class="s2">&quot;&#x25A0;&quot;</span><span class="p">,</span> <span class="s2">&quot;&#x25C6;&quot;</span><span class="p">,</span> <span class="s2">&quot;&#x271A;&quot;</span><span class="p">,</span> <span class="s2">&quot;&#x2716;&quot;</span> <span class="p">],</span>
    <span class="nx">color</span><span class="o">:</span> <span class="p">[</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="p">],</span>
    <span class="nx">size</span><span class="o">:</span> <span class="mi">12</span><span class="p">,</span>
    <span class="nx">orthographic</span><span class="o">:</span> <span class="kc">true</span>
  <span class="p">}</span>

  <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="mi">100</span><span class="p">;</span> <span class="o">++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">theta</span> <span class="o">=</span> <span class="nx">i</span> <span class="o">/</span> <span class="mf">100.0</span> <span class="o">*</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span>
    <span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">cos</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span>
    <span class="kd">var</span> <span class="nx">y</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sin</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span>
    <span class="nx">initialData</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">push</span><span class="p">([</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="mi">0</span> <span class="p">])</span>
    <span class="nx">initialData</span><span class="p">.</span><span class="nx">glyph</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s2">&quot;&#x25CF;&quot;</span><span class="p">)</span>
    <span class="nx">initialData</span><span class="p">.</span><span class="nx">color</span><span class="p">.</span><span class="nx">push</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
  <span class="p">}</span>

  <span class="nx">points</span> <span class="o">=</span> <span class="nx">createPoints</span><span class="p">(</span><span class="nx">gl</span><span class="p">,</span> <span class="nx">initialData</span><span class="p">)</span>

  <span class="nx">axes</span> <span class="o">=</span> <span class="nx">createAxes</span><span class="p">(</span><span class="nx">gl</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">bounds</span><span class="o">:</span> <span class="p">[[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]],</span>
    <span class="nx">tickSpacing</span><span class="o">:</span> <span class="p">[.</span><span class="mi">1</span><span class="p">,</span> <span class="p">.</span><span class="mi">1</span><span class="p">,</span> <span class="p">.</span><span class="mi">1</span><span class="p">]</span>
  <span class="p">})</span>

  <span class="nx">select</span> <span class="o">=</span> <span class="nx">createSelect</span><span class="p">(</span><span class="nx">gl</span><span class="p">,</span> <span class="p">[</span><span class="nx">shell</span><span class="p">.</span><span class="nx">height</span><span class="p">,</span> <span class="nx">shell</span><span class="p">.</span><span class="nx">width</span><span class="p">])</span>
<span class="p">})</span>

<span class="kd">function</span> <span class="nx">updatePick</span><span class="p">(</span><span class="nx">cameraParams</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">//Update size of select buffer</span>
  <span class="nx">select</span><span class="p">.</span><span class="nx">shape</span> <span class="o">=</span> <span class="p">[</span><span class="nx">shell</span><span class="p">.</span><span class="nx">height</span><span class="p">,</span> <span class="nx">shell</span><span class="p">.</span><span class="nx">width</span><span class="p">]</span>

  <span class="c1">//Begin pass, look for points within 30 pixels of mouse</span>
  <span class="nx">select</span><span class="p">.</span><span class="nx">begin</span><span class="p">(</span><span class="nx">shell</span><span class="p">.</span><span class="nx">mouse</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">shell</span><span class="p">.</span><span class="nx">mouse</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">30</span><span class="p">)</span>

  <span class="c1">//Draw point cloud pick buffer</span>
  <span class="nx">points</span><span class="p">.</span><span class="nx">drawPick</span><span class="p">(</span><span class="nx">cameraParams</span><span class="p">)</span>

  <span class="c1">//End pass, retrieve selection information</span>
  <span class="kd">var</span> <span class="nx">selected</span> <span class="o">=</span> <span class="nx">select</span><span class="p">.</span><span class="nx">end</span><span class="p">()</span>

  <span class="c1">//Look up point id in scatter plot, mark as highlighted</span>
  <span class="kd">var</span> <span class="nx">target</span> <span class="o">=</span> <span class="nx">points</span><span class="p">.</span><span class="nx">pick</span><span class="p">(</span><span class="nx">selected</span><span class="p">)</span>
  <span class="k">if</span><span class="p">(</span><span class="nx">target</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">points</span><span class="p">.</span><span class="nx">highlight</span><span class="p">(</span><span class="nx">target</span><span class="p">.</span><span class="nx">index</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">points</span><span class="p">.</span><span class="nx">highlight</span><span class="p">()</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nx">shell</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;gl-render&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">gl</span> <span class="o">=</span> <span class="nx">shell</span><span class="p">.</span><span class="nx">gl</span>

  <span class="c1">//Compute camera paramters</span>
  <span class="kd">var</span> <span class="nx">cameraParams</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">view</span><span class="o">:</span> <span class="nx">camera</span><span class="p">.</span><span class="nx">view</span><span class="p">(),</span>
    <span class="nx">projection</span><span class="o">:</span> <span class="nx">mat4</span><span class="p">.</span><span class="nx">perspective</span><span class="p">(</span>
        <span class="nx">mat4</span><span class="p">.</span><span class="nx">create</span><span class="p">(),</span>
        <span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="o">/</span><span class="mf">4.0</span><span class="p">,</span>
        <span class="nx">shell</span><span class="p">.</span><span class="nx">width</span><span class="o">/</span><span class="nx">shell</span><span class="p">.</span><span class="nx">height</span><span class="p">,</span>
        <span class="mf">0.1</span><span class="p">,</span>
        <span class="mf">1000.0</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="c1">//Turn on z-buffer</span>
  <span class="nx">gl</span><span class="p">.</span><span class="nx">enable</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">DEPTH_TEST</span><span class="p">)</span>

  <span class="c1">//Update point picking data</span>
  <span class="nx">updatePick</span><span class="p">(</span><span class="nx">cameraParams</span><span class="p">)</span>

  <span class="c1">//Update camera</span>
  <span class="nx">points</span><span class="p">.</span><span class="nx">draw</span><span class="p">(</span><span class="nx">cameraParams</span><span class="p">)</span>
  <span class="nx">axes</span><span class="p">.</span><span class="nx">draw</span><span class="p">(</span><span class="nx">cameraParams</span><span class="p">)</span>
<span class="p">})</span>
</code></pre>
<h1 id="install">Install</h1>
<pre><code>npm install gl-scatter-plot
</code></pre><h1 id="api">API</h1>
<pre><code class="lang-javascript"><span class="kd">var</span> <span class="nx">createScatterPlot</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;gl-scatter-plot&quot;</span><span class="p">)</span>
</code></pre>
<h2 id="constructor">Constructor</h2>
<h4 id="-var-points-createscatterplot-gl-options-"><code>var points = createScatterPlot(gl, options)</code></h4>
<p>Constructs a scatter plot with the given parameters.  </p>
<ul>
<li><code>gl</code> is a WebGL context</li>
<li><code>options</code> is a JSON object containing configuration data for the scatter plot.  For more information, see the documentation in the <code>.update</code> method</li>
</ul>
<p><strong>Returns</strong> A new scatter plot object</p>
<h2 id="method">Method</h2>
<h3 id="basic-rendering">Basic rendering</h3>
<h4 id="-points-update-options-"><code>points.update(options)</code></h4>
<p>Updates the scatter plot object.  The parameter <code>options</code> is an object with the following properties:</p>
<ul>
<li><code>position</code> (Required) an array of length 3 arrays encoding the position of the points in the scatter plot.</li>
<li><code>color</code> A length 3 array encoding the color of the points in the scatter plot.  To set colors per point, pass an array instead.  Default is <code>[0,0,0]</code></li>
<li><code>glyph</code> The glyph of each point.  This is a UTF8 string representing some shape.  Per point glyphs can be specified by passing an array.  The default glyph is a circle, <code>&quot;&#x25CF;&quot;</code>.  For more glyph ideas, check out the <a href="http://unicode-table.com/en/">unicode character set</a>.  Some other fun suggestions: <code>&quot;&#x2622;&quot;, &quot;&#x262F;&quot;, &quot;&#x2764;&quot;, &quot;&#x25B2;&quot;, &quot;&#x2691;&quot;</code>. </li>
<li><code>size</code> The size of each point, or specified per-point using an array.  In orthographic, this is in screen coordinates, or in perspective this is in world coordinates. Default is <code>0.1</code></li>
<li><code>orthographic</code> A flag, which if set to <code>true</code> causes the points to be drawn without perspective scaling.</li>
<li><code>pickId</code> An 8 bit value which determines the tag for all elements within the pick buffer</li>
<li><code>lineWidth</code> the width of the outline (set to 0 for no outline) Default is <code>0</code></li>
<li><code>lineColor</code> the color of the outline for each marker</li>
<li><code>font</code> the font used for drawing the glyphs (default <code>normal</code>)</li>
<li><code>angle</code> an angle to rotate the glyphs by in radians (default <code>0</code>)</li>
<li><code>alignment</code> a 2d vector to offset text drawing by (default <code>[0,0]</code>)</li>
<li><code>project</code> a flag (or array of flags) which determines which axes to project onto</li>
<li><code>axisBounds</code> a pair of 3d arrays representing the bounds of the axes to project onto</li>
<li><code>projectOpacity</code> the opacity of the projected point sprites (default <code>1.0</code>)</li>
<li><code>projectScale</code> the scaling factor of the projected point sprites (default <code>2.0/3.0</code>)</li>
</ul>
<h4 id="-points-draw-camera-"><code>points.draw(camera)</code></h4>
<p>Draws the scatter plot with the given camera parameters.</p>
<ul>
<li><p><code>camera</code> is a JSON object storing the camera parameters for the point cloud.  It has the following properties:</p>
<ul>
<li><code>model</code> the model matrix, encoded as a length 16 array</li>
<li><code>view</code> the view matrix of the camera, encoded as a length 16 array</li>
<li><code>projection</code> the projection matrix of the camera, encoded as a length 16 array</li>
</ul>
</li>
</ul>
<h4 id="-points-dispose-"><code>points.dispose()</code></h4>
<p>Destroys the scatter plot object and releases all stored resources.</p>
<h3 id="picking">Picking</h3>
<h4 id="-points-drawpick-camera-"><code>points.drawPick(camera)</code></h4>
<p>Draws the scatter plot into a pick buffer for point selection purposes.</p>
<ul>
<li><code>camera</code> is a camera object, with the same properties as in <code>draw</code></li>
</ul>
<h4 id="-points-pick-selected-"><code>points.pick(selected)</code></h4>
<p>Finds the index of a point selected by some mouse coordinate. </p>
<ul>
<li><code>selected</code> is the selection information returned by calling end on a <code>gl-select</code> object</li>
</ul>
<p><strong>Returns</strong> An object representing the highlighted point, or <code>null</code> if no point is selected. The object has the following properties:</p>
<ul>
<li><code>index</code> which is the index of the selected point</li>
<li><code>position</code> which the 3D position of the selected point in data coordinates</li>
</ul>
<h4 id="-points-highlight-pointid-highlightcolor-"><code>points.highlight(pointId, highlightColor)</code></h4>
<p>Highlights the point with index <code>pointId</code> in the scatter plot by changing its color to <code>highlightColor</code></p>
<ul>
<li><code>pointId</code> is the index of a point in the scatter plot</li>
<li><code>highlightColor</code> is the color to draw the highlighted point with</li>
</ul>
<p>If this function is called with no arguments, then it will deselect the currently highlighted point.</p>
<h2 id="properties">Properties</h2>
<h4 id="-points-bounds-"><code>points.bounds</code></h4>
<p>Lower and upper bounds on the point cloud</p>
<h4 id="-points-clipbounds-"><code>points.clipBounds</code></h4>
<p>A pair of arrays that determine lower and upper bounds on the scatter plot to draw.  These are useful for clipping the scatter plot to a smaller region.</p>
<h1 id="credits">Credits</h1>
<p>(c) 2014 Mikola Lysenko. MIT License.  Supported by <a href="https://plot.ly/">plot.ly</a></p>
