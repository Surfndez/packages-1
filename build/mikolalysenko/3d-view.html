<h1 id="3d-view"><a target="_blank" href="http://github.com/mikolalysenko/3d-view">3d-view</a></h1>
<p>This module is a generic interface which synchronizes several existing view interactions</p>
<ul>
<li><a href="https://github.com/mikolalysenko/turntable-camera-controller">turntable-camera-controller</a></li>
<li><a href="https://github.com/mikolalysenko/orbit-camera-controller">orbit-camera-controller</a></li>
<li><a href="https://github.com/mikolalysenko/orbit-camera-controller">matrix-camera-controller</a></li>
</ul>
<p>Each camera controller proceeds by appending events onto a log.  The current camera state is obtained by interpolating between these events.</p>
<iframe scrolling="no" seamless="seamless" src="http://mikolalysenko.github.io/3d-view/"></iframe><h1 id="api">API</h1>
<p><a href="https://mikolalysenko.github.io/3d-view">Try a more complete demo here</a></p>
<pre><code class="lang-javascript"><span class="kd">var</span> <span class="nx">now</span>            <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&apos;right-now&apos;</span><span class="p">)</span>
<span class="kd">var</span> <span class="nx">bunny</span>          <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&apos;bunny&apos;</span><span class="p">)</span>
<span class="kd">var</span> <span class="nx">perspective</span>    <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&apos;gl-mat4/perspective&apos;</span><span class="p">)</span>
<span class="kd">var</span> <span class="nx">fit</span>            <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&apos;canvas-fit&apos;</span><span class="p">)</span>
<span class="kd">var</span> <span class="nx">createContext</span>  <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&apos;gl-context&apos;</span><span class="p">)</span>
<span class="kd">var</span> <span class="nx">createAxes</span>     <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&apos;gl-axes&apos;</span><span class="p">)</span>
<span class="kd">var</span> <span class="nx">createMesh</span>     <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&apos;gl-simplicial-complex&apos;</span><span class="p">)</span>
<span class="kd">var</span> <span class="nx">createCamera</span>   <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&apos;3d-view&apos;</span><span class="p">)</span>

<span class="c1">//Set up WebGL</span>
<span class="kd">var</span> <span class="nx">canvas</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&apos;canvas&apos;</span><span class="p">)</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">canvas</span><span class="p">)</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&apos;resize&apos;</span><span class="p">,</span> <span class="nx">fit</span><span class="p">(</span><span class="nx">canvas</span><span class="p">),</span> <span class="kc">false</span><span class="p">)</span>
<span class="kd">var</span> <span class="nx">gl</span> <span class="o">=</span> <span class="nx">createContext</span><span class="p">(</span><span class="nx">canvas</span><span class="p">,</span> <span class="p">{},</span> <span class="nx">render</span><span class="p">)</span>

<span class="c1">//Create objects for rendering</span>
<span class="kd">var</span> <span class="nx">bounds</span> <span class="o">=</span> <span class="p">[[</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="o">-</span><span class="mi">10</span><span class="p">],</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">]]</span>
<span class="kd">var</span> <span class="nx">mesh</span> <span class="o">=</span> <span class="nx">createMesh</span><span class="p">(</span><span class="nx">gl</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">cells</span><span class="o">:</span> <span class="nx">bunny</span><span class="p">.</span><span class="nx">cells</span><span class="p">,</span>
    <span class="nx">positions</span><span class="o">:</span> <span class="nx">bunny</span><span class="p">.</span><span class="nx">positions</span><span class="p">,</span>
    <span class="nx">colormap</span><span class="o">:</span> <span class="s1">&apos;jet&apos;</span>
  <span class="p">})</span>
<span class="kd">var</span> <span class="nx">axes</span> <span class="o">=</span> <span class="nx">createAxes</span><span class="p">(</span><span class="nx">gl</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">bounds</span><span class="o">:</span> <span class="nx">bounds</span><span class="p">,</span>
    <span class="nx">tickSpacing</span><span class="o">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span>
    <span class="nx">textSize</span><span class="o">:</span> <span class="mf">0.05</span>
  <span class="p">})</span>

<span class="c1">//Set up camera</span>
<span class="kd">var</span> <span class="nx">projectionMatrix</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Array</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span>
<span class="kd">var</span> <span class="nx">camera</span> <span class="o">=</span> <span class="nx">createCamera</span><span class="p">({</span>
  <span class="nx">center</span><span class="o">:</span>  <span class="p">[</span>
    <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="nx">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="nx">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span>
    <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="nx">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="nx">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span>
    <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="nx">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="nx">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span> <span class="p">],</span>
  <span class="nx">eye</span><span class="o">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]],</span>
  <span class="nx">distanceLimits</span><span class="o">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">]</span>
<span class="p">})</span>

<span class="c1">//Create mode drop down</span>
<span class="kd">var</span> <span class="nx">modeSelect</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&apos;select&apos;</span><span class="p">)</span>
<span class="nx">camera</span><span class="p">.</span><span class="nx">modes</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">mode</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">modeSelect</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="k">new</span> <span class="nx">Option</span><span class="p">(</span><span class="nx">mode</span><span class="p">,</span> <span class="nx">mode</span><span class="p">))</span>
<span class="p">})</span>
<span class="nx">modeSelect</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">position</span> <span class="o">=</span> <span class="s1">&apos;absolute&apos;</span>
<span class="nx">modeSelect</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">left</span> <span class="o">=</span> <span class="s1">&apos;10px&apos;</span>
<span class="nx">modeSelect</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">top</span> <span class="o">=</span> <span class="s1">&apos;10px&apos;</span>
<span class="nx">modeSelect</span><span class="p">.</span><span class="nx">style</span><span class="p">[</span><span class="s1">&apos;z-index&apos;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">modeSelect</span><span class="p">)</span>


<span class="c1">//Hook event listeners</span>
<span class="kd">var</span> <span class="nx">lastX</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">lastY</span> <span class="o">=</span> <span class="mi">0</span>

<span class="nb">document</span><span class="p">.</span><span class="nx">oncontextmenu</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span> 
  <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span>
  <span class="nx">e</span><span class="p">.</span><span class="nx">stopPropagation</span><span class="p">()</span>
  <span class="k">return</span> <span class="kc">false</span> 
<span class="p">}</span>

<span class="nx">modeSelect</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&apos;change&apos;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ev</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">camera</span><span class="p">.</span><span class="nx">setMode</span><span class="p">(</span><span class="nx">modeSelect</span><span class="p">.</span><span class="nx">value</span><span class="p">)</span>
<span class="p">})</span>

<span class="nx">canvas</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&apos;mousemove&apos;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ev</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">dx</span> <span class="o">=</span>  <span class="p">(</span><span class="nx">ev</span><span class="p">.</span><span class="nx">clientX</span> <span class="o">-</span> <span class="nx">lastX</span><span class="p">)</span> <span class="o">/</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">drawingBufferWidth</span>
  <span class="kd">var</span> <span class="nx">dy</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="nx">ev</span><span class="p">.</span><span class="nx">clientY</span> <span class="o">-</span> <span class="nx">lastY</span><span class="p">)</span> <span class="o">/</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">drawingBufferHeight</span>
  <span class="k">if</span><span class="p">(</span><span class="nx">ev</span><span class="p">.</span><span class="nx">which</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">ev</span><span class="p">.</span><span class="nx">shiftKey</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">//zoom</span>
      <span class="nx">camera</span><span class="p">.</span><span class="nx">rotate</span><span class="p">(</span><span class="nx">now</span><span class="p">(),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">dx</span><span class="p">)</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="c1">//rotate</span>
      <span class="nx">camera</span><span class="p">.</span><span class="nx">rotate</span><span class="p">(</span><span class="nx">now</span><span class="p">(),</span> <span class="nx">dx</span><span class="p">,</span> <span class="nx">dy</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">ev</span><span class="p">.</span><span class="nx">which</span> <span class="o">===</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//pan</span>
    <span class="nx">camera</span><span class="p">.</span><span class="nx">pan</span><span class="p">(</span><span class="nx">now</span><span class="p">(),</span> <span class="nx">dx</span><span class="p">,</span> <span class="nx">dy</span><span class="p">)</span>
  <span class="p">}</span>
  <span class="nx">lastX</span> <span class="o">=</span> <span class="nx">ev</span><span class="p">.</span><span class="nx">clientX</span>
  <span class="nx">lastY</span> <span class="o">=</span> <span class="nx">ev</span><span class="p">.</span><span class="nx">clientY</span>
<span class="p">})</span>

<span class="nx">canvas</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&apos;wheel&apos;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">camera</span><span class="p">.</span><span class="nx">pan</span><span class="p">(</span><span class="nx">now</span><span class="p">(),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">e</span><span class="p">.</span><span class="nx">deltaY</span><span class="p">)</span>
<span class="p">})</span>

<span class="c1">//Redraw frame</span>
<span class="kd">function</span> <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>

  <span class="c1">//Update camera parameters</span>
  <span class="kd">var</span> <span class="nx">t</span> <span class="o">=</span> <span class="nx">now</span><span class="p">()</span>
  <span class="nx">camera</span><span class="p">.</span><span class="nx">idle</span><span class="p">(</span><span class="nx">t</span> <span class="o">-</span> <span class="mi">20</span><span class="p">)</span>
  <span class="nx">camera</span><span class="p">.</span><span class="nx">flush</span><span class="p">(</span><span class="nx">t</span> <span class="o">-</span> <span class="mi">100</span><span class="p">)</span>
  <span class="nx">camera</span><span class="p">.</span><span class="nx">recalcMatrix</span><span class="p">(</span><span class="nx">t</span><span class="o">-</span><span class="mi">25</span><span class="p">)</span>

  <span class="c1">//Compute parameters</span>
  <span class="kd">var</span> <span class="nx">cameraParams</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">view</span><span class="o">:</span> <span class="nx">camera</span><span class="p">.</span><span class="nx">computedMatrix</span><span class="p">,</span>
    <span class="nx">projection</span><span class="o">:</span> <span class="nx">perspective</span><span class="p">(</span>
      <span class="p">[],</span>
      <span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="o">/</span><span class="mf">4.0</span><span class="p">,</span>
      <span class="nx">gl</span><span class="p">.</span><span class="nx">drawingBufferWidth</span><span class="o">/</span><span class="nx">gl</span><span class="p">.</span><span class="nx">drawingBufferHeight</span><span class="p">,</span>
      <span class="mf">0.1</span><span class="p">,</span>
      <span class="mf">1000.0</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="c1">//Draw everything</span>
  <span class="nx">gl</span><span class="p">.</span><span class="nx">viewport</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">drawingBufferWidth</span><span class="p">,</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">drawingBufferHeight</span><span class="p">)</span>
  <span class="nx">gl</span><span class="p">.</span><span class="nx">enable</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">DEPTH_TEST</span><span class="p">)</span>
  <span class="nx">axes</span><span class="p">.</span><span class="nx">draw</span><span class="p">(</span><span class="nx">cameraParams</span><span class="p">)</span>
  <span class="nx">mesh</span><span class="p">.</span><span class="nx">draw</span><span class="p">(</span><span class="nx">cameraParams</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>
<h2 id="constructor">Constructor</h2>
<h4 id="-var-camera-require-3d-view-options-"><code>var camera = require(&apos;3d-view&apos;)([options])</code></h4>
<h2 id="methods">Methods</h2>
<h4 id="-camera-idle-t-"><code>camera.idle(t)</code></h4>
<p>Idles the camera at time <code>t</code></p>
<ul>
<li><code>t</code> is the time to idle at</li>
</ul>
<h4 id="-camera-flush-t-"><code>camera.flush(t)</code></h4>
<p>Flush all events in camera state before time <code>t</code></p>
<ul>
<li><code>t</code> is the cut off time for the flush</li>
</ul>
<h4 id="-camera-modes-"><code>camera.modes</code></h4>
<p>An array of modes supported by the camera</p>
<h4 id="-camera-setmode-mode-"><code>camera.setMode(mode)</code></h4>
<p>Sets the camera mode</p>
<ul>
<li><code>mode</code> is the new mode.  Must be either <code>turntable</code>, <code>orbit</code> or <code>matrix</code></li>
</ul>
<h4 id="-camera-getmode-"><code>camera.getMode()</code></h4>
<p>Retrieves the current camera mode</p>
<h4 id="-camera-lookat-t-eye-center-up-"><code>camera.lookAt(t, eye, center, up)</code></h4>
<p>Reset camera position to focus on a specified target</p>
<ul>
<li><code>t</code> is the time of the event</li>
<li><code>eye</code> is the position of the camera</li>
<li><code>center</code> is the target of the camera</li>
<li><code>up</code> is a vector pointing up</li>
</ul>
<h4 id="-camera-rotate-t-yaw-pitch-roll-"><code>camera.rotate(t, yaw, pitch, roll)</code></h4>
<p>Rotates the camera incrementally by some amount</p>
<ul>
<li><code>t</code> is the time of the input event</li>
<li><code>yaw</code> is the amount to rotate by along y-axis in radians</li>
<li><code>pitch</code> is the amount to rotate by along x-axis in radians</li>
<li><code>roll</code> is the amount to rotate by along z-axis in radians</li>
</ul>
<h4 id="-camera-pan-t-dx-dy-dz-"><code>camera.pan(t, dx, dy, dz)</code></h4>
<p>Pans the camera in local (view relative) coordinates</p>
<ul>
<li><code>t</code> is the time of the event</li>
<li><code>dx,dy,dz</code> is the amount to move</li>
</ul>
<h4 id="-camera-translate-t-dx-dy-dz-"><code>camera.translate(t, dx, dy, dz)</code></h4>
<p>Translates the camera in world (absolute global) coordinates</p>
<ul>
<li><code>t</code> is the time of the event</li>
<li><code>dx,dy,dz</code> is the amount to move</li>
</ul>
<h4 id="-camera-setmatrix-t-matrix-"><code>camera.setMatrix(t, matrix)</code></h4>
<p>Sets the camera matrix to some fixed 4x4 matrix</p>
<ul>
<li><code>t</code> is the time of the event</li>
<li><code>matrix</code> is the new camera matrix</li>
</ul>
<h4 id="-camera-setdistance-t-r-"><code>camera.setDistance(t, r)</code></h4>
<p>Sets camera distance at time <code>t</code></p>
<ul>
<li><code>t</code> is the time of the event</li>
<li><code>r</code> is the new camera distance</li>
</ul>
<h4 id="-camera-setdistancelimits-lo-hi-"><code>camera.setDistanceLimits(lo, hi)</code></h4>
<p>Sets bounds on the camera distance</p>
<h4 id="-camera-getdistancelimits-out-"><code>camera.getDistanceLimits([out])</code></h4>
<p>Retrieves the camera limits</p>
<h4 id="-camera-recalcmatrix-t-"><code>camera.recalcMatrix(t)</code></h4>
<p>Recomputes all matrix properties at time <code>t</code></p>
<h4 id="-camera-computedmatrix-"><code>camera.computedMatrix</code></h4>
<p>The computed 4x4 matrix of the camera</p>
<h4 id="-camera-computedeye-"><code>camera.computedEye</code></h4>
<p>The computed 3d eye vector for the camera</p>
<h4 id="-camera-computedup-"><code>camera.computedUp</code></h4>
<p>Computed up vector (initialized when calling recalcMatrix)</p>
<h4 id="-camera-computedcenter-"><code>camera.computedCenter</code></h4>
<p>Computed camera center point</p>
<h4 id="-camera-computedradius-"><code>camera.computedRadius</code></h4>
<p>Computed log(radius)</p>
<h1 id="license">License</h1>
<p>(c) 2015 Mikola Lysenko. MIT License</p>
