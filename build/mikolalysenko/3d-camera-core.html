<p><strong>WORK IN PROGRESS</strong></p>
<h1 id="3d-camera-core"><a target="_blank" href="http://github.com/mikolalysenko/3d-camera-core">3d-camera-core</a></h1>
<p>A common interface for 3D cameras.  This module is a caching layer for maintaining coordinate system transformations and computing camera properties from a set of generating matrices. This module is intended to be used as a common interface and should not be required directly.</p>
<h3 id="notes-on-coordinates">Notes on coordinates</h3>
<p>By convention, we will define 4 different 3 dimensional projective homogeneous coordinate systems:</p>
<ul>
<li><strong>Data coordinates</strong>: The coordinates used by models and 3D data</li>
<li><strong>World coordinates</strong>: A common coordinate system for all objects within the scene</li>
<li><strong>Camera coordinates</strong>: The coordinate system in the world where the camera is at the center</li>
<li><strong>Clip coordinates</strong>: The device clip coordinate system</li>
</ul>
<p>These coordinates are related by a set of three homogeneous 4x4 matrices:</p>
<ul>
<li><strong>Model matrix</strong>: Maps data coordinates to world coordinates</li>
<li><strong>View matrix</strong>: Maps world coordinates to camera coordinates</li>
<li><strong>Projection matrix</strong>: Maps view coordinates to device clip coordinates</li>
</ul>
<p>The goal of this module is to maintain the relationships between these coordinate systems as matrices and to define a standard interface for renderable objects which need to consume camera information.  Implementors should take this module and hook up whatever methods they want to compute the model/view/projection matrices, while users can then treat the resulting camera interface as a black box handling the various coordinate system conversions.</p>
<h1 id="user-side">User side</h1>
<p>For most users of this module, you only need to worry about the stuff in this section.</p>
<h2 id="user-example">User example</h2>
<pre><code class="lang-javascript"><span class="c1">//You should call some other module to create a camera controller</span>
<span class="kd">var</span> <span class="nx">myCamera</span> <span class="o">=</span> <span class="nx">createCameraType</span><span class="p">()</span>

<span class="c1">//Once you have a camera, then you can access the coordinate conversions directly</span>
<span class="kd">var</span> <span class="nx">dataToClip</span> <span class="o">=</span> <span class="nx">myCamera</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">toClip</span>

<span class="c1">//You can also access the origin of the camera in any coordinate system too</span>
<span class="kd">var</span> <span class="nx">eyePosition</span> <span class="o">=</span> <span class="nx">myCamera</span><span class="p">.</span><span class="nx">world</span><span class="p">.</span><span class="nx">origin</span>
</code></pre>
<h2 id="user-api">User API</h2>
<p>The overall goal of this module is to keep track of conversions between a number of different coordinate systems.  Because multiplying and recalculating these conversions is expensive, this module caches this data for future use.  After a camera object has been created, no further memory allocations are performed.</p>
<h3 id="coordinate-system-conversions">Coordinate system conversions</h3>
<p>The most basic function of this module is to provide a convenient syntax for getting whatever camera transformations you need.</p>
<h4 id="-coords-toclip-"><code>coords.toClip</code></h4>
<p>A 4x4 matrix representing the conversion from <code>coords</code> into clip coordinates.</p>
<h4 id="-coords-tocamera-"><code>coords.toCamera</code></h4>
<p>A 4x4 matrix representing the conversion from <code>coords</code> into camera coordinates.</p>
<h4 id="-coords-toworld-"><code>coords.toWorld</code></h4>
<p>A 4x4 matrix representing the conversion from <code>coords</code> into world coordinates</p>
<h4 id="-coords-todata-"><code>coords.toData</code></h4>
<p>A 4x4 matrix representing the conversion from <code>coords</code> into data coordinates.</p>
<h3 id="origin">Origin</h3>
<h4 id="-coords-origin-"><code>coords.origin</code></h4>
<p>The position of the camera in the coordinate system.</p>
<h1 id="for-implementors">For implementors</h1>
<p>A camera implementation should provide one or more &quot;controllers&quot; for each of the model, view and projection matrices.  Each controller is an object with two methods; one which tests if the controller has changed and one which reads out the state of the matrix for the controller.</p>
<h2 id="implementation-example">Implementation example</h2>
<pre><code class="lang-javascript"><span class="kd">var</span> <span class="nx">createCamera</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&apos;3d-camera-core&apos;</span><span class="p">)</span>

<span class="c1">//A simple implementation of a camera controller</span>
<span class="kd">function</span> <span class="nx">simpleController</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span>
              <span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span>
              <span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span>
              <span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
  <span class="kd">var</span> <span class="nx">isDirty</span> <span class="o">=</span> <span class="kc">false</span>
  <span class="k">return</span> <span class="p">{</span>
    <span class="nx">dirty</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">isDirty</span>
    <span class="p">},</span>
    <span class="nx">get</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">m</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">isDirty</span> <span class="o">=</span> <span class="kc">false</span>
      <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="mi">16</span><span class="p">;</span> <span class="o">++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">m</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">data</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">set</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">m</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">isDirty</span> <span class="o">=</span> <span class="kc">true</span>
      <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="mi">16</span><span class="p">;</span> <span class="o">++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">data</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">m</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">//Create a set of controllers for the camera object</span>
<span class="kd">var</span> <span class="nx">controllers</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">model</span><span class="o">:</span> <span class="nx">simpleController</span><span class="p">(),</span>
  <span class="nx">view</span><span class="o">:</span> <span class="nx">simpleController</span><span class="p">(),</span>
  <span class="nx">projection</span><span class="o">:</span> <span class="nx">simpleController</span><span class="p">()</span>
<span class="p">}</span>

<span class="c1">//Return camera</span>
<span class="kd">var</span> <span class="nx">camera</span> <span class="o">=</span> <span class="nx">createCamera</span><span class="p">(</span><span class="nx">controllers</span><span class="p">)</span>
</code></pre>
<h2 id="implementor-api">Implementor API</h2>
<h3 id="constructor">Constructor</h3>
<h4 id="-var-camera-createcamera-controllers-"><code>var camera = createCamera(controllers)</code></h4>
<p>This creates a new camera object with the given controllers.  <code>controllers</code> is an object with the following properties:</p>
<ul>
<li><code>controllers.model</code> a controller for the model matrix</li>
<li><code>controllers.view</code> a controller for view matrix</li>
<li><code>controllers.projection</code> a controller for the projection matrix</li>
</ul>
<p><strong>Returns</strong> A new camera object</p>
<h3 id="controller-interface">Controller interface</h3>
<p>Each controller is an object which provides two methods:</p>
<h4 id="-controller-dirty-"><code>controller.dirty()</code></h4>
<p>This method should test if the state of the controller has changed since the last time <code>controller.get()</code> was called.  If it has, then the matrix value will be recomputed.</p>
<p><strong>Returns</strong> <code>true</code> if the camera matrix has changed, otherwise <code>false</code></p>
<h4 id="-controller-get-matrix-"><code>controller.get(matrix)</code></h4>
<p>This retrieves the state of the controller&apos;s matrix.  The result should be written into <code>matrix</code></p>
<h3 id="methods">Methods</h3>
<h4 id="-camera-setcontroller-matrix-controller-"><code>camera.setController(matrix, controller)</code></h4>
<p>Replaces the controller on the camera for <code>matrix</code> with <code>controller</code>.</p>
<ul>
<li><code>matrix</code> is the name of the matrix, which is either <code>model</code>, <code>view</code> or <code>projection</code></li>
<li><code>controller</code> is the new controller for the matrix</li>
</ul>
<h1 id="legal">Legal</h1>
<p>(c) 2015 Mikola Lysenko.  MIT License</p>
